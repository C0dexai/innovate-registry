<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CUA Engine: Orchestration Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for a consistent dark theme */
        :root {
            --primary-color: #60b5ff; /* A vibrant blue for main actions */
            --secondary-color: #8a4bff; /* A complementary purple */
            --accent-color: #10b981; /* Green for success/highlight */
            --danger-color: #ef4444; /* Red for errors */

            --dark-bg: #111827; /* Dark background */
            --dark-surface: #1f2937; /* Slightly lighter surface for cards/panels */
            --dark-surface-light: #374151; /* Even lighter for hover/active states */
            --dark-text: #e5e7eb; /* Light text for dark background */
            --dark-text-muted: #9ca3af; /* Muted text */
            --dark-border: #4b5563; /* Subtle borders */

            --font-sans: 'Inter', sans-serif;
            --font-mono: 'Space Mono', monospace; /* For code blocks */

            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-xxl: 48px;

            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;

            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15);

            --transition-fast: 0.15s ease-out;
            --transition-normal: 0.3s ease-in-out;
            --transition-slow: 0.5s ease-in-out;
        }

        /* Base styles for the entire page */
        body {
            font-family: var(--font-sans);
            background-color: var(--dark-bg);
            color: var(--dark-text);
            margin: 0;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--white);
            margin-top: 0;
            margin-bottom: var(--spacing-md);
            font-weight: 700;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--secondary-color);
        }

        button, .btn {
            cursor: pointer;
            border: none;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 600;
            transition: transform var(--transition-fast), background-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        button:hover, .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-secondary {
            background: var(--dark-surface-light);
            color: var(--dark-text);
            border: 1px solid var(--dark-border);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-danger {
            background: var(--danger-color);
            color: var(--white);
        }

        .btn:disabled {
            background-color: var(--dark-border);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--primary-color);
            padding: 0;
            font-weight: normal;
            text-decoration: underline;
        }

        .btn-link:hover {
            color: var(--secondary-color);
            transform: none;
            box-shadow: none;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--dark-border);
            background-color: var(--dark-surface);
            color: var(--dark-text);
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(96, 181, 255, 0.2);
        }

        /* Utility Classes (inspired by Tailwind) */
        .container {
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--spacing-md);
            padding-right: var(--spacing-md);
        }

        .hidden { display: none !important; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-col { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        .gap-sm { gap: var(--spacing-sm); }
        .gap-md { gap: var(--spacing-md); }
        .gap-lg { gap: var(--spacing-lg); }
        .py-md { padding-top: var(--spacing-md); padding-bottom: var(--spacing-md); }
        .px-md { padding-left: var(--spacing-md); padding-right: var(--spacing-md); }
        .py-lg { padding-top: var(--spacing-lg); padding-bottom: var(--spacing-lg); }
        .my-lg { margin-top: var(--spacing-lg); margin-bottom: var(--spacing-lg); }
        .mb-md { margin-bottom: var(--spacing-md); }
        .mb-lg { margin-bottom: var(--spacing-lg); }
        .text-center { text-align: center; }
        .text-muted { color: var(--dark-text-muted); }
        .font-bold { font-weight: 700; }
        .small { font-size: 0.875rem; }
        .rounded-md { border-radius: var(--radius-md); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }
        .transition-all { transition: all var(--transition-normal); }

        /* Animation */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.6s ease-out forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(8px);
            z-index: 1000;
            padding: var(--spacing-md) var(--spacing-lg);
            box-shadow: var(--shadow-md);
            transition: background-color 0.3s ease-in-out;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: var(--spacing-lg);
        }

        .nav-link {
            color: var(--dark-text-muted);
            font-weight: 500;
            transition: color var(--transition-fast);
        }

        .nav-link:hover, .nav-link.active {
            color: var(--white);
        }

        .navbar-info {
            display: flex;
            gap: var(--spacing-lg);
            font-size: 0.875rem;
            color: var(--dark-text-muted);
        }

        /* Main Content Area */
        .main-content {
            padding-top: 80px;
            min-height: calc(100vh - 80px);
            padding-bottom: var(--spacing-xxl);
        }

        .page-section {
            min-height: calc(100vh - 80px);
            padding: var(--spacing-xxl) var(--spacing-md);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .page-section h1 {
            font-size: 3rem;
            margin-bottom: var(--spacing-lg);
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-section p {
            max-width: 800px;
            font-size: 1.125rem;
            color: var(--dark-text-muted);
            margin-bottom: var(--spacing-xxl);
        }

        /* Home Page */
        #home-page .cta-buttons {
            display: flex;
            gap: var(--spacing-md);
        }

        /* Agent Grid (from main.js) */
        .agent-grid, .orchestration-grid, .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            padding: var(--spacing-lg) 0;
            max-width: 1200px;
            margin: var(--spacing-xxl) auto;
        }

        .card {
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            transition: transform var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: var(--shadow-lg);
        }

        .card-selected {
            border-color: var(--accent-color) !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3) !important;
            transform: translateY(-2px);
        }

        /* Agent Card specific */
        .agent-card .agent-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-md);
            flex-shrink: 0;
        }

        .agent-card .agent-initial {
            font-size: 2rem;
            font-weight: 700;
            color: var(--white);
        }

        .agent-card .agent-name {
            font-size: 1.3rem;
            color: var(--white);
            margin-bottom: var(--spacing-xs);
        }

        .agent-card .agent-role {
            color: var(--accent-color);
            margin-bottom: var(--spacing-md);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .agent-card .agent-philosophy {
            font-style: italic;
            color: var(--dark-text-muted);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-md);
            min-height: 40px;
        }

        .agent-card .agent-focus {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-top: auto;
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--dark-border);
        }

        .agent-card .focus-tag {
            background: var(--dark-surface-light);
            color: var(--dark-text-muted);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Orchestration Card specific */
        .orchestration-card .orchestration-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        .orchestration-card .orchestration-name {
            font-size: 1.3rem;
            color: var(--white);
            margin-bottom: var(--spacing-xs);
        }

        .orchestration-card .orchestration-description {
            color: var(--dark-text-muted);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-md);
            min-height: 40px;
        }

        .orchestration-card .agent-badge {
            background: var(--dark-surface-light);
            color: var(--dark-text-muted);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: var(--spacing-md);
        }

        .orchestration-card .orchestration-steps-count {
            color: var(--accent-color);
            font-size: 0.85rem;
            margin-top: var(--spacing-sm);
        }

        /* Detail Panel (Agent Specific) */
        .detail-panel {
            background: var(--dark-surface);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            max-width: 900px;
            margin: var(--spacing-xxl) auto;
            box-shadow: var(--shadow-xl);
        }

        .agent-detail-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--dark-border);
        }

        .agent-detail-avatar {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .agent-detail-initial {
            font-size: 3rem;
            font-weight: 700;
            color: var(--white);
        }

        .agent-detail-name {
            font-size: 2rem;
            color: var(--white);
            margin-bottom: var(--spacing-xs);
        }

        .agent-detail-role {
            color: var(--accent-color);
            margin: 0;
            font-weight: 500;
            font-size: 1.1rem;
        }

        .agent-detail-philosophy {
            font-style: italic;
            color: var(--dark-text-muted);
            font-size: 0.95rem;
            margin-top: var(--spacing-sm);
        }

        .agent-detail-section {
            margin-bottom: var(--spacing-lg);
        }

        .detail-section-title {
            font-size: 1.1rem;
            color: var(--white);
            margin-bottom: var(--spacing-md);
            border-left: 3px solid var(--accent-color);
            padding-left: var(--spacing-md);
        }

        .detail-section-text {
            color: var(--dark-text-muted);
            line-height: 1.7;
        }

        .focus-areas {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .focus-area-tag {
            background: var(--dark-surface-light);
            color: var(--dark-text-muted);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .packaging-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .packaging-item {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
        }

        .packaging-type {
            font-size: 1rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }

        .packaging-description {
            color: var(--dark-text-muted);
            font-size: 0.875rem;
            margin-bottom: var(--spacing-xs);
        }

        .packaging-tool {
            font-size: 0.75rem;
            color: var(--accent-color);
            font-family: var(--font-mono);
        }

        .agent-actions {
            margin-top: var(--spacing-xl);
            text-align: center;
        }

        /* Chat Container */
        .chat-container {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-lg);
            margin-top: var(--spacing-xl);
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            height: 450px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .chat-log {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            scrollbar-width: thin;
            scrollbar-color: var(--dark-border) transparent;
        }

        .chat-log::-webkit-scrollbar {
            width: 8px;
        }

        .chat-log::-webkit-scrollbar-thumb {
            background-color: var(--dark-border);
            border-radius: 4px;
        }

        .chat-log::-webkit-scrollbar-track {
            background-color: transparent;
        }

        .chat-message {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
            max-width: 80%;
        }

        .chat-message-user {
            background-color: var(--primary-color);
            color: var(--white);
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 0;
        }

        .chat-message-ai {
            background-color: var(--dark-surface-light);
            color: var(--dark-text);
            align-self: flex-start;
            margin-right: auto;
            border-bottom-left-radius: 0;
        }

        .message-content {
            word-wrap: break-word;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: var(--spacing-xs);
            text-align: right;
        }

        .chat-form {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md) 0;
            border-top: 1px solid var(--dark-border);
        }

        .chat-input {
            flex: 1;
            border-radius: var(--radius-full);
            padding-left: var(--spacing-lg);
            padding-right: var(--spacing-lg);
        }

        #send-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            font-weight: 600;
        }

        /* Orchestration Output Panel */
        .orchestration-output-panel {
            background: var(--dark-surface);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            max-width: 900px;
            margin: var(--spacing-xxl) auto;
            box-shadow: var(--shadow-xl);
        }

        .orchestration-output-panel h2 {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            font-size: 2rem;
            color: var(--white);
        }

        .orchestration-steps-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .orchestration-step {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            width: 100%;
        }

        .step-number {
            background: var(--accent-color);
            color: var(--white);
            border-radius: var(--radius-full);
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .step-info {
            flex: 1;
        }

        .step-tool-name {
            font-size: 1rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }

        .step-agent {
            font-size: 0.85rem;
            color: var(--dark-text-muted);
        }

        .step-loader {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 3px solid var(--dark-border);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .step-details {
            width: 100%;
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px dashed var(--dark-border);
            text-align: left;
        }

        .step-details code {
            background-color: var(--dark-bg);
            border-radius: var(--radius-sm);
            padding: var(--spacing-xs) var(--spacing-sm);
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--accent-color);
            display: inline-block;
            word-break: break-all;
        }

        /* Custom Instructions Panel */
        .custom-instructions-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: var(--dark-surface);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
            z-index: 1200;
            transition: right var(--transition-normal);
            display: flex;
            flex-direction: column;
        }

        .custom-instructions-panel.panel-open {
            right: 0;
        }

        .instructions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--dark-border);
        }

        .instructions-header h3 {
            margin: 0;
            color: var(--white);
            font-size: 1.25rem;
        }

        .instructions-body {
            flex: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
        }

        .instructions-body label {
            display: block;
            margin-bottom: var(--spacing-sm);
            color: var(--dark-text);
            font-weight: 600;
        }

        .instructions-body textarea {
            min-height: 100px;
            margin-bottom: var(--spacing-lg);
        }

        .instructions-actions {
            padding: var(--spacing-md) var(--spacing-lg);
            border-top: 1px solid var(--dark-border);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
        }

        /* Error/Success Notifications */
        .error-notification,
        .success-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1300;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            max-width: 400px;
            box-shadow: var(--shadow-xl);
            animation: fadeInNotification 0.3s ease-out;
        }

        .error-notification {
            border-left: 4px solid var(--danger-color);
        }

        .success-notification {
            border-left: 4px solid var(--accent-color);
        }

        @keyframes fadeInNotification {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .notification-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .notification-message {
            color: var(--dark-text);
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--dark-text-muted);
            font-size: 1.25rem;
            cursor: pointer;
            line-height: 1;
        }

        .notification-close:hover {
            color: var(--white);
        }

        /* Modals (from docs.js and main.js) */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            pointer-events: none;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .modal-content {
            background: var(--dark-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            max-width: 600px;
            width: 90%;
            z-index: 1510;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity var(--transition-fast), transform var(--transition-fast);
            pointer-events: auto;
        }

        /* Active modal state */
        .modal:not(.hidden) {
            pointer-events: auto;
        }
        .modal:not(.hidden) .modal-overlay {
            opacity: 1;
        }
        .modal:not(.hidden) .modal-content {
            opacity: 1;
            transform: translateY(0);
        }

        .modal-sm {
            max-width: 400px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--dark-border);
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--white);
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--dark-text-muted);
            font-size: 1.75rem;
            cursor: pointer;
            line-height: 1;
        }

        .close-btn:hover {
            color: var(--white);
        }

        .modal-body {
            padding: var(--spacing-lg);
            color: var(--dark-text);
            overflow-y: auto;
            max-height: 70vh;
        }

        /* Download Modal specifics */
        .download-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .download-option {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            text-align: left;
        }

        .download-option h4 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }

        .download-option p {
            font-size: 0.9rem;
            color: var(--dark-text-muted);
            margin-bottom: var(--spacing-sm);
        }

        .download-option ul {
            list-style: none;
            padding: 0;
            margin-bottom: var(--spacing-md);
        }

        .download-option ul li {
            font-size: 0.85rem;
            color: var(--dark-text-muted);
            margin-bottom: var(--spacing-xs);
        }
        .download-option .btn {
            width: 100%;
            margin-top: var(--spacing-md);
        }

        .download-info {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            text-align: left;
        }
        .download-info h4 {
            color: var(--accent-color);
            margin-bottom: var(--spacing-sm);
        }

        .download-progress {
            text-align: center;
        }
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
            font-size: 0.9rem;
        }
        .progress-bar {
            background: var(--dark-border);
            height: 8px;
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: var(--spacing-sm);
        }
        .progress-fill {
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            height: 100%;
            width: 0%;
            border-radius: var(--radius-full);
            transition: width 0.2s linear;
        }
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--dark-text-muted);
        }

        .download-complete {
            text-align: center;
        }
        .complete-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            color: var(--accent-color);
        }
        .download-complete h4 {
            margin-bottom: var(--spacing-sm);
            color: var(--white);
        }
        .download-complete ol {
            list-style-position: inside;
            padding: 0;
            text-align: left;
            margin: 0 auto var(--spacing-md);
            max-width: 300px;
        }
        .download-complete ol li {
            margin-bottom: var(--spacing-sm);
            color: var(--dark-text-muted);
        }
        .help-links {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        /* Docs Page */
        .docs-container {
            display: flex;
            max-width: 1400px;
            margin: var(--spacing-xxl) auto;
            background: var(--dark-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            min-height: calc(100vh - 160px);
        }

        .docs-nav {
            width: 250px;
            flex-shrink: 0;
            padding: var(--spacing-lg);
            border-right: 1px solid var(--dark-border);
            overflow-y: auto;
        }

        .docs-nav ul {
            list-style: none;
            padding: 0;
        }

        .docs-nav li {
            margin-bottom: var(--spacing-sm);
        }

        .docs-nav .nav-link {
            display: block;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            color: var(--dark-text-muted);
            transition: background-color var(--transition-fast), color var(--transition-fast);
        }

        .docs-nav .nav-link:hover {
            background-color: var(--dark-surface-light);
            color: var(--white);
        }

        .docs-nav .nav-link.active {
            background-color: var(--primary-color);
            color: var(--white);
            font-weight: 600;
        }

        .docs-content {
            flex: 1;
            padding: var(--spacing-xl);
            overflow-y: auto;
        }

        .doc-section {
            margin-bottom: var(--spacing-xxl);
        }

        .doc-section h2 {
            font-size: 2rem;
            color: var(--white);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--dark-border);
        }

        .doc-section h3 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
        }

        .doc-section p, .doc-section ul, .doc-section ol {
            color: var(--dark-text-muted);
            margin-bottom: var(--spacing-md);
        }

        .doc-section ul, .doc-section ol {
            padding-left: var(--spacing-lg);
        }

        .doc-section pre {
            background-color: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
        }

        .doc-section code {
            font-family: var(--font-mono);
            color: var(--accent-color);
            font-size: 0.9rem;
        }

        .code-block {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }

        .code-block pre {
            position: relative;
        }

        .code-block .copy-btn {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            background-color: var(--dark-surface-light);
            color: var(--dark-text);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            transition: background-color var(--transition-fast);
        }

        .code-block .copy-btn:hover {
            background-color: var(--primary-color);
            color: var(--white);
        }

        /* Contact Page */
        .contact-section {
            background: var(--dark-surface);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            max-width: 800px;
            margin: var(--spacing-xxl) auto;
            box-shadow: var(--shadow-xl);
            text-align: left;
        }

        .contact-section h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: var(--spacing-lg);
            color: var(--white);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
            color: var(--dark-text);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--dark-border);
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-actions {
            text-align: center;
            margin-top: var(--spacing-xl);
        }

        .contact-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-xl);
            border-top: 1px solid var(--dark-border);
        }

        .info-item {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
        }

        .info-item h4 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }

        .info-item p, .info-item a {
            color: var(--dark-text-muted);
            font-size: 0.95rem;
        }

        .faq-section {
            margin-top: var(--spacing-xxl);
            padding-top: var(--spacing-xxl);
            border-top: 1px solid var(--dark-border);
        }

        .faq-section h3 {
            text-align: center;
            font-size: 1.75rem;
            margin-bottom: var(--spacing-xl);
            color: var(--white);
        }

        .faq-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .faq-item {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            transition: var(--transition-normal);
            cursor: pointer;
            text-align: left;
        }

        .faq-item:hover {
            background: var(--dark-surface-light);
        }

        .faq-item.expanded {
            background: var(--dark-surface-light);
        }

        .faq-question {
            position: relative;
            padding-right: 2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .faq-question::after {
            content: '+';
            position: absolute;
            right: 0;
            top: 0;
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--accent-color);
            transition: transform var(--transition-fast);
        }

        .faq-item.expanded .faq-question::after {
            transform: rotate(45deg);
        }

        .faq-answer {
            display: none;
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--dark-border);
            animation: fadeInDown 0.3s ease;
            color: var(--dark-text-muted);
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-input.error,
        .form-textarea.error,
        .form-select.error {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .form-error {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: var(--spacing-xs);
            display: none;
        }

        .btn-loading {
            display: none;
        }

        /* Services Page (from services.js) */
        .service-card {
            background: linear-gradient(145deg, var(--dark-surface), #2a3544);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            transition: var(--transition-normal);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .service-card:hover {
            border-color: var(--accent-color);
            box-shadow: 0 10px 20px rgba(96, 181, 255, 0.1);
        }

        .service-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .service-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .service-initial {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
        }

        .service-name {
            font-size: 1.5rem;
            color: var(--white);
            margin-bottom: var(--spacing-xs);
        }

        .service-role {
            color: var(--accent-color);
            margin: 0;
            font-weight: 500;
        }

        .service-content {
            flex: 1;
            margin-bottom: var(--spacing-lg);
        }

        .service-philosophy {
            font-style: italic;
            color: var(--dark-text-muted);
            border-left: 3px solid var(--accent-color);
            padding-left: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .service-description {
            color: var(--dark-text-muted);
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
        }

        .focus-title,
        .tools-title {
            font-size: 1rem;
            color: var(--white);
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
        }

        .focus-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }

        .service-card .focus-tag {
            background: var(--primary-color);
            color: var(--white);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .tools-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }

        .tool-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm);
            background: var(--dark-bg);
            border-radius: var(--radius-sm);
            border: 1px solid var(--dark-border);
        }

        .tool-type {
            font-weight: 500;
            color: var(--white);
            font-size: 0.875rem;
        }

        .tool-utility {
            font-family: var(--font-mono);
            color: var(--dark-text-muted);
            font-size: 0.75rem;
        }

        .service-actions {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            margin-top: auto;
        }

        .service-cta {
            flex: 1;
            min-width: 140px;
            text-align: center;
        }

        /* Orchestration Hub (main layout for control panel) */
        body.control-panel-open {
            overflow: hidden;
        }

        .orchestration-hub-layout {
            display: flex;
            min-height: calc(100vh - 80px);
            padding-top: 80px;
        }

        .orchestration-main-content {
            flex: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
            padding-bottom: var(--spacing-xxl);
        }

        .orchestration-control-panel {
            width: 400px;
            flex-shrink: 0;
            background: var(--dark-surface-light);
            border-left: 1px solid var(--dark-border);
            position: fixed;
            right: -400px;
            top: 0px;
            height: 100%;
            z-index: 1100;
            transition: right var(--transition-normal);
            display: flex;
            flex-direction: column;
            padding-top: 80px;
        }

        body.control-panel-open .orchestration-control-panel {
            right: 0;
        }

        .control-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--dark-border);
            position: absolute;
            top: 80px;
            width: 100%;
            background: var(--dark-surface-light);
            z-index: 1;
        }

        .control-panel-header h3 {
            margin: 0;
            font-size: 1.25rem;
            color: var(--white);
        }

        .control-panel-close {
            background: none;
            border: none;
            color: var(--dark-text-muted);
            font-size: 1.75rem;
            cursor: pointer;
            line-height: 1;
        }

        .control-panel-close:hover {
            color: var(--white);
        }

        .control-panel-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-lg);
            padding-top: 60px;
        }

        .control-panel-section {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .control-panel-section h4 {
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
        }

        .form-field-group {
            margin-bottom: var(--spacing-md);
        }

        .form-field-group label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--dark-text-muted);
        }

        .chain-list, .task-list, .log-output {
            background-color: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm);
            max-height: 250px;
            overflow-y: auto;
        }

        .chain-step, .task-item {
            background-color: #2b3a4a;
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
            position: relative;
        }

        .chain-step-header {
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: var(--spacing-xs);
        }

        .chain-step-content div {
            font-size: 0.85rem;
            color: var(--dark-text-muted);
            word-break: break-all;
        }

        .chain-step-remove {
            position: absolute;
            top: var(--spacing-xs);
            right: var(--spacing-xs);
            background: var(--danger-color);
            color: var(--white);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            line-height: 1;
            opacity: 0.8;
        }
        .chain-step-remove:hover {
            opacity: 1;
        }

        .task-item {
            margin-bottom: var(--spacing-sm);
            padding: var(--spacing-sm);
            background-color: #2b3a4a;
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-md);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xs);
        }

        .task-name {
            font-size: 0.95rem;
            color: var(--white);
            margin: 0;
        }

        .task-status {
            font-size: 0.75rem;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-weight: 600;
        }

        .task-status.pending { background-color: #f59e0b; color: var(--white); }
        .task-status.running { background-color: #3b82f6; color: var(--white); }
        .task-status.completed { background-color: #10b981; color: var(--white); }
        .task-status.stopped { background-color: #ef4444; color: var(--white); }

        .task-agent {
            font-size: 0.8rem;
            color: var(--dark-text-muted);
            margin-bottom: var(--spacing-xs);
        }

        .task-details {
            font-size: 0.8rem;
            color: var(--dark-text-muted);
            margin-bottom: var(--spacing-sm);
        }

        .task-actions .btn-sm {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: 0.75rem;
        }

        .log-entry {
            font-size: 0.8rem;
            color: var(--dark-text-muted);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: flex-start;
        }

        .log-timestamp {
            background-color: var(--dark-surface-light);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            margin-right: var(--spacing-sm);
            flex-shrink: 0;
        }

        .log-entry.log-error .log-timestamp { background-color: var(--danger-color); color: var(--white); }
        .log-entry.log-system .log-timestamp { background-color: var(--primary-color); color: var(--white); }

        /* Chat specific to Orchestration Hub */
        .orchestration-chat-container {
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            height: 400px;
        }

        .orchestration-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            scrollbar-width: thin;
            scrollbar-color: var(--dark-border) transparent;
        }

        .orchestration-chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .orchestration-chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--dark-border);
            border-radius: 4px;
        }

        .orchestration-chat-messages::-webkit-scrollbar-track {
            background-color: transparent;
        }

        .chat-message-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--dark-text-muted);
            margin-bottom: var(--spacing-xs);
        }

        .chat-message-user .message-sender { color: var(--primary-color); }
        .chat-message-ai .message-sender { color: var(--accent-color); }

        .orchestration-chat-form {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md) 0;
            border-top: 1px solid var(--dark-border);
        }

        .orchestration-chat-input {
            flex: 1;
            border-radius: var(--radius-full);
            padding-left: var(--spacing-lg);
            padding-right: var(--spacing-lg);
        }

        #chat-send-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            font-weight: 600;
        }

        /* Media Queries for responsiveness */
        @media (max-width: 1024px) {
            .docs-container {
                flex-direction: column;
            }
            .docs-nav {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--dark-border);
                padding-bottom: var(--spacing-md);
            }
            .docs-nav ul {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            .docs-nav li {
                margin-right: var(--spacing-sm);
                margin-bottom: var(--spacing-sm);
            }
            .docs-content {
                padding: var(--spacing-lg);
            }

            .orchestration-hub-layout {
                flex-direction: column;
            }
            .orchestration-control-panel {
                position: relative;
                width: 100%;
                right: 0;
                border-left: none;
                border-top: 1px solid var(--dark-border);
                box-shadow: none;
                padding-top: var(--spacing-lg);
            }
            .control-panel-header {
                position: relative;
                top: 0;
                width: 100%;
                padding-top: 0;
                padding-bottom: var(--spacing-sm);
            }
            .control-panel-body {
                padding-top: var(--spacing-md);
            }
            body.control-panel-open {
                overflow: auto;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                align-items: flex-start;
                padding-bottom: var(--spacing-sm);
            }
            .nav-links {
                margin-top: var(--spacing-md);
                flex-wrap: wrap;
                gap: var(--spacing-sm);
            }
            .navbar-info {
                margin-top: var(--spacing-md);
            }
            
            .page-section h1 {
                font-size: 2.5rem;
            }
            
            .agent-grid, .orchestration-grid, .services-grid {
                grid-template-columns: 1fr;
            }

            .detail-panel, .orchestration-output-panel, .contact-section {
                padding: var(--spacing-lg);
                margin: var(--spacing-lg) auto;
            }

            .agent-detail-header {
                flex-direction: column;
                text-align: center;
            }

            .custom-instructions-panel {
                width: 100%;
                right: -100%;
            }
            .custom-instructions-panel.panel-open {
                right: 0;
            }

            .error-notification,
            .success-notification {
                left: 20px;
                right: 20px;
                max-width: none;
            }

            .service-actions {
                flex-direction: column;
            }
            
            .service-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="#home" class="navbar-brand">CUA Engine</a>
        <div class="nav-links">
            <a href="#home" class="nav-link active" data-nav-target="home">Home</a>
            <a href="#services" class="nav-link" data-nav-target="services">Services</a>
            <a href="#docs" class="nav-link" data-nav-target="docs">Docs</a>
            <a href="#contact" class="nav-link" data-nav-target="contact">Contact</a>
            <a href="#orchestration-hub" class="nav-link" data-nav-target="orchestration-hub">Orchestration Hub</a>
        </div>
        <div class="navbar-info">
            <span>User ID: <span id="user-id"></span></span>
            <span>Session ID: <span id="session-id"></span></span>
        </div>
    </nav>

    <!-- Main Content Area - SPA Container -->
    <div class="main-content">
        <!-- Home Page / Agent Selection -->
        <section id="home-page" class="page-section">
            <div class="container text-center">
                <h1>Welcome to the CUA Engine</h1>
                <p>
                    Your advanced AI development assistant. Select an agent below to start
                    a specialized conversation or explore powerful orchestrations.
                </p>
                <div class="cta-buttons">
                    <a href="#orchestration-hub" class="btn btn-primary">Go to Orchestration Hub</a>
                    <a href="#services" class="btn btn-secondary">Explore AI Services</a>
                </div>

                <div class="info-panel fade-in">
                    <h3>Select an AI Agent</h3>
                    <p class="text-muted">Choose a specialized AI to assist with your development tasks:</p>
                    <div id="agent-grid" class="agent-grid">
                        <!-- Agent cards will be dynamically loaded here by main.js -->
                    </div>
                </div>

                <div class="info-panel fade-in">
                    <h3>Orchestration Bookmarks</h3>
                    <p class="text-muted">Quick-start complex workflows and multi-agent operations:</p>
                    <div id="orchestration-grid" class="orchestration-grid">
                        <!-- Orchestration cards will be dynamically loaded here by main.js -->
                    </div>
                </div>
            </div>

            <!-- Agent Detail Panel -->
            <div id="detail-panel" class="detail-panel hidden">
                <div id="detail-content">
                    <!-- Agent details will be loaded here by main.js -->
                </div>
            </div>

            <!-- Orchestration Output Panel -->
            <div id="orchestration-output-panel" class="orchestration-output-panel hidden">
                <h2 id="orchestration-title">Executing Orchestration</h2>
                <div id="orchestration-steps" class="orchestration-steps-container">
                    <!-- Orchestration steps will be loaded here by main.js -->
                </div>
            </div>
        </section>

        <!-- Services Page -->
        <section id="services-page" class="page-section hidden">
            <div class="container text-center">
                <h1>Our AI Services</h1>
                <p>Explore the specialized capabilities of our AI agents, designed to accelerate your development workflow.</p>
                <div id="services-grid" class="services-grid">
                    <!-- Service cards will be dynamically loaded here by services.js -->
                </div>
            </div>
        </section>

        <!-- Docs Page -->
        <section id="docs-page" class="page-section hidden">
            <div class="docs-container">
                <nav class="docs-nav">
                    <ul>
                        <li><a href="#introduction" class="nav-link">Introduction</a></li>
                        <li><a href="#setup" class="nav-link">Setup Guide</a></li>
                        <li><a href="#api-reference" class="nav-link">API Reference</a></li>
                        <li><a href="#agents" class="nav-link">AI Agents Overview</a></li>
                        <li><a href="#orchestration" class="nav-link">Orchestration Chains</a></li>
                        <li><a href="#custom-instructions" class="nav-link">Custom Instructions</a></li>
                        <li><a href="#memory-system" class="nav-link">Memory System</a></li>
                        <li><a href="#troubleshooting" class="nav-link">Troubleshooting</a></li>
                        <li><a href="#faq" class="nav-link">FAQ</a></li>
                    </ul>
                    <div class="my-lg">
                        <button id="download-project" class="btn btn-primary">
                            Download Project Files
                        </button>
                    </div>
                </nav>
                <div class="docs-content">
                    <div id="introduction" class="doc-section">
                        <h2>Introduction to CUA Engine</h2>
                        <p>Welcome to the Comprehensive Unified AI (CUA) Engine documentation. This system is designed to streamline your development processes through intelligent AI assistance and automated workflows.</p>
                        <p>The CUA Engine provides a suite of specialized AI agents, each with unique expertise, and a powerful orchestration hub to chain these agents together for complex tasks.</p>
                        <h3>Key Features:</h3>
                        <ul>
                            <li><strong>Specialized AI Agents:</strong> Access a family of AIs, each tailored for specific development roles like architecture, performance, security, and documentation.</li>
                            <li><strong>Workflow Orchestration:</strong> Define and execute multi-step workflows by chaining AI tools and agents.</li>
                            <li><strong>Adaptive Behavior:</strong> Agents learn and adapt based on your interactions and preferences.</li>
                            <li><strong>Memory System:</strong> Persistent memory for agent states, conversation history, and user preferences.</li>
                            <li><strong>Custom Instructions:</strong> Fine-tune AI behavior and persona for each session.</li>
                        </ul>
                    </div>
                    
                    <div id="setup" class="doc-section">
                        <h2>Setup Guide</h2>
                        <p>Getting started with the CUA Engine is straightforward. Follow these steps:</p>
                        <h3>1. Download the Project</h3>
                        <p>Download the latest release from the <a href="#" onclick="window.downloadProject('complete'); return false;">Download Project Files</a> button in the navigation or sidebar.</p>
                        <h3>2. Extract Files</h3>
                        <p>Unzip the downloaded package to your preferred directory.</p>
                        <h3>3. Host on a Web Server</h3>
                        <p>The CUA Engine is a pure frontend application. You can host it on any static web server (e.g., Apache, Nginx, Firebase Hosting, Netlify, Vercel). Simply upload the extracted files to your web server's root directory.</p>
                        <pre><code>/cua-engine
     index.html
     css/
     js/
        main.js
        data.js
        memory.js
        ... (other JS files)
     assets/
</code></pre>
                        <h3>4. Open in Browser</h3>
                        <p>Navigate to `index.html` in your web browser. The application should load automatically.</p>
                        <h3>5. Initial Configuration (Optional)</h3>
                        <p>The system is ready to use out-of-the-box. For advanced configurations, you can modify `data.js` to add/remove AI agents or tools, or use the "Custom Instructions" panel in the Orchestration Hub.</p>
                    </div>
                    
                    <div id="api-reference" class="doc-section">
                        <h2>API Reference (Conceptual)</h2>
                        <p>The CUA Engine internally utilizes a conceptual API for inter-agent communication and tool execution. While this is primarily an internal system, understanding its structure can help in customizing workflows.</p>
                        <h3>Core Functions:</h3>
                        <ul>
                            <li><code>analyze_requirements(input: string)</code>: DAN provides comprehensive requirement analysis.</li>
                            <li><code>design_architecture(input: string)</code>: LYRA designs system architecture based on requirements.</li>
                            <li><code>scaffold_component(input: string, params: object)</code>: KARA generates code components.</li>
                            <li><code>review_security(input: string)</code>: SOPHIA performs security audits.</li>
                            <li><code>generate_test_cases(input: string)</code>: SOPHIA creates test suites.</li>
                            <li><code>generate_documentation(input: string)</code>: CECILIA generates technical documentation.</li>
                            <li><code>create_build_pipeline(input: string, params: object)</code>: MISTRESS configures CI/CD.</li>
                            <li><code>optimize_performance(input: string)</code>: KARA analyzes and optimizes performance.</li>
                            <li><code>design_user_interface(input: string)</code>: DUDE designs UI/UX.</li>
                            <li><code>implement_innovation(input: string)</code>: KARL integrates modern technologies.</li>
                        </ul>
                        <h3>Example Usage (Simplified):</h3>
                        <div class="code-block">
                            <pre><code>// Example: Chaining tools for a full-stack feature
const featureBrief = "Develop a user authentication module with secure login.";

// Step 1: Analyze Requirements
const requirementsOutput = await CUA_App.executeTool("analyze_requirements", featureBrief);
console.log("Requirements:", requirementsOutput);

// Step 2: Design Architecture
const architectureOutput = await CUA_App.executeTool("design_architecture", requirementsOutput);
console.log("Architecture:", architectureOutput);

// Step 3: Scaffold Component
const scaffoldOutput = await CUA_App.executeTool("scaffold_component", architectureOutput, { language: "React" });
console.log("Scaffolding:", scaffoldOutput);
</code></pre>
                        </div>
                    </div>
                    
                    <div id="agents" class="doc-section">
                        <h2>AI Agents Overview</h2>
                        <p>The CUA Engine comprises a family of specialized AI agents, each with unique expertise and personality, designed to assist with different facets of software development.</p>
                        <h3>Agent Profiles:</h3>
                        <ul>
                            <li><strong>LYRA (The Architect):</strong> Focuses on system architecture and design patterns. Prioritizes clarity and scalability.</li>
                            <li><strong>KARA (The Builder):</strong> Specializes in performance optimization and efficient implementation. Delivers practical, optimized solutions.</li>
                            <li><strong>SOPHIA (The Guardian):</strong> Expert in security and quality assurance. Ensures robust error handling and vulnerability assessment.</li>
                            <li><strong>CECILIA (The Documentarian):</strong> Dedicated to documentation and knowledge management. Creates comprehensive and user-friendly guides.</li>
                            <li><strong>DAN (The Analyst):</strong> Excels at requirements analysis and data-driven solutions. Considers edge cases and provides thorough research.</li>
                            <li><strong>STAN (The Traditionalist):</strong> Advocates for code quality and best practices using time-tested approaches.</li>
                            <li><strong>DUDE (The User Advocate):</strong> Focuses on user experience and interface design, ensuring usability and accessibility.</li>
                            <li><strong>KARL (The Innovator):</strong> Brings innovative solutions with modern technologies, challenging conventional approaches.</li>
                            <li><strong>MISTRESS (The Orchestrator):</strong> Manages workflow orchestration and system integration, bringing harmony to complex processes.</li>
                        </ul>
                        <p>Each agent can be selected to engage in a specialized conversation or be part of a multi-step orchestration chain.</p>
                    </div>

                    <div id="orchestration" class="doc-section">
                        <h2>Orchestration Chains</h2>
                        <p>Orchestration chains allow you to define a sequence of tasks to be executed by different AI agents and tools. This enables complex, multi-step workflows that automate development processes.</p>
                        <h3>Creating a Chain:</h3>
                        <ol>
                            <li>Navigate to the "Orchestration Hub" section.</li>
                            <li>In the "3-Chain Management System", add System, AI, and User instructions for each step.</li>
                            <li>Each step represents a phase of your workflow, potentially involving different AI behaviors.</li>
                            <li>Use the "Apply Instructions to AI" button to make your chained instructions active for the system.</li>
                        </ol>
                        <h3>Pre-defined Bookmarks:</h3>
                        <p>The system comes with several pre-defined orchestration bookmarks:</p>
                        <ul>
                            <li><strong>Full-Stack Feature Genesis:</strong> From feature brief to documented and testable code.</li>
                            <li><strong>Interactive App Deployment:</strong> Generates code, containerizes, and sets up deployment.</li>
                            <li><strong>Security-First Development:</strong> Comprehensive security assessment and hardening.</li>
                            <li><strong>Performance Optimization Suite:</strong> Detailed performance analysis and optimization.</li>
                        </ul>
                        <p>These bookmarks demonstrate how different agents and tools can be combined for powerful automation.</p>
                    </div>

                    <div id="custom-instructions" class="doc-section">
                        <h2>Custom Instructions</h2>
                        <p>The "Custom Instructions" panel allows you to fine-tune the AI's behavior, personality, and contextual understanding for the current session. This is crucial for guiding the AI to produce responses that align with your specific project needs or preferred interaction style.</p>
                        <h3>Instruction Types:</h3>
                        <ul>
                            <li><strong>System:</strong> Defines the AI's overall role, persona, and constraints (e.g., "You are a senior software architect...").</li>
                            <li><strong>AI:</strong> Specifies how the AI should respond or behave (e.g., "Always provide structured solutions...").</li>
                            <li><strong>User:</strong> Informs the AI about your (the user's) preferences or context (e.g., "I prefer concise answers...").</li>
                        </ul>
                        <h3>Applying Instructions:</h3>
                        <p>Access the "Custom Instructions" panel from the home page or the Orchestration Hub. Enter your instructions into the respective text areas and click "Save & Apply". These instructions will then influence all AI interactions for the current session.</p>
                    </div>

                    <div id="memory-system" class="doc-section">
                        <h2>Memory System</h2>
                        <p>The CUA Engine incorporates a robust memory system to enable personalized and adaptive AI interactions. This system stores:</p>
                        <ul>
                            <li><strong>Conversation History:</strong> Retains past interactions with each AI agent, allowing for contextual continuity.</li>
                            <li><strong>Agent States:</strong> Stores dynamic properties of agents like mood, energy level, and learned preferences.</li>
                            <li><strong>User Preferences:</strong> Learns and adapts to your communication style, detail level, and other preferences over time.</li>
                            <li><strong>Interaction Metrics:</strong> Tracks usage patterns and relationship levels with agents.</li>
                        </ul>
                        <p>This persistent memory helps agents provide more relevant and efficient assistance over multiple sessions.</p>
                    </div>

                    <div id="troubleshooting" class="doc-section">
                        <h2>Troubleshooting</h2>
                        <p>If you encounter issues with the CUA Engine, please refer to these common solutions:</p>
                        <h3>"CUA_DATA not available" error:</h3>
                        <p>This typically means the `data.js` script was not loaded correctly or experienced an error. Ensure all script tags in `index.html` are correct and ordered properly.</p>
                        <h3>Page not loading or blank:</h3>
                        <p>Check your browser's developer console for JavaScript errors. Ensure all file paths are correct and the server is serving all assets.</p>
                        <h3>Features not responding:</h3>
                        <p>Verify that relevant JavaScript files (e.g., `main.js`, `orchestration.js`) are loaded and their initialization functions are being called. Look for `console.log` messages indicating successful initialization.</p>
                        <h3>Download issues:</h3>
                        <p>The download functionality is simulated. If you are expecting actual file downloads and they are not occurring, check your browser's download settings or any ad blockers that might interfere.</p>
                        <h3>Still stuck?</h3>
                        <p>Please use the <a href="#contact">Contact Us</a> page to report your issue with detailed steps to reproduce.</p>
                    </div>

                    <div id="faq" class="doc-section">
                        <h2>Frequently Asked Questions</h2>
                        <div class="faq-list">
                            <div class="faq-item">
                                <h4 class="faq-question">Is this a real AI backend?</h4>
                                <div class="faq-answer">
                                    <p>The CUA Engine is a conceptual framework and a frontend demonstration. The AI responses and orchestrations are simulated client-side to showcase potential interactions and workflows. It does not connect to a live AI model or a backend server by default. However, it's designed to be extensible for future integrations.</p>
                                </div>
                            </div>
                            <div class="faq-item">
                                <h4 class="faq-question">Can I add my own AI agents or tools?</h4>
                                <div class="faq-answer">
                                    <p>Yes! You can modify the <code>data.js</code> file to define new AI agents, their roles, philosophies, and associated tools. This allows for deep customization of the CUA Engine's capabilities.</p>
                                </div>
                            </div>
                            <div class="faq-item">
                                <h4 class="faq-question">How does the memory system work?</h4>
                                <div class="faq-answer">
                                    <p>The memory system uses your browser's local storage to persist conversation history, agent states, and user preferences. This means your interactions are remembered across browser sessions on the same device.</p>
                                </div>
                            </div>
                            <div class="faq-item">
                                <h4 class="faq-question">Is the custom instructions panel persistent?</h4>
                                <div class="faq-answer">
                                    <p>Custom instructions set via the panel are active for the current session. They are not saved persistently by default but can be integrated with the memory system for future enhancements.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Page -->
        <section id="contact-page" class="page-section hidden">
            <div class="contact-section">
                <h2>Contact Us</h2>
                <p class="text-muted text-center">Have questions, feedback, or need support? Reach out to us!</p>
                
                <form id="contact-form">
                    <div class="form-group">
                        <label for="name">Your Name <span style="color:var(--danger-color);">*</span></label>
                        <input type="text" id="name" name="name" class="form-input" required minlength="2">
                        <p id="name-error" class="form-error"></p>
                    </div>
                    <div class="form-group">
                        <label for="email">Your Email <span style="color:var(--danger-color);">*</span></label>
                        <input type="email" id="email" name="email" class="form-input" required>
                        <p id="email-error" class="form-error"></p>
                    </div>
                    <div class="form-group">
                        <label for="service">Service Interested In</label>
                        <select id="service" name="service" class="form-select">
                            <option value="">-- Select a Service --</option>
                            <option value="general_inquiry">General Inquiry</option>
                            <option value="system_architecture">System Architecture</option>
                            <option value="performance_optimization">Performance Optimization</option>
                            <option value="security_audit">Security Audit</option>
                            <option value="documentation">Documentation Services</option>
                            <option value="requirements_analysis">Requirements Analysis</option>
                            <option value="ui_ux_design">UI/UX Design</option>
                            <option value="innovation_consulting">Innovation Consulting</option>
                            <option value="workflow_orchestration">Workflow Orchestration</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="subject">Subject <span style="color:var(--danger-color);">*</span></label>
                        <input type="text" id="subject" name="subject" class="form-input" required>
                        <p id="subject-error" class="form-error"></p>
                    </div>
                    <div class="form-group">
                        <label for="project-details">Project Details / Message <span style="color:var(--danger-color);">*</span></label>
                        <textarea id="project-details" name="project_details" class="form-textarea" rows="6" required></textarea>
                        <p id="project_details-error" class="form-error"></p>
                    </div>
                    <div class="form-actions">
                        <button type="submit" id="submit-btn" class="btn btn-primary">
                            <span class="btn-text">Send Message</span>
                            <span class="btn-loading hidden">
                                <div class="loader-sm"></div> Sending...
                            </span>
                        </button>
                    </div>
                </form>

                <div id="success-message" class="success-notification hidden">
                    <div class="notification-content">
                        <span class="notification-icon"></span>
                        <span class="notification-message">Your message has been sent successfully! We'll get back to you shortly.</span>
                    </div>
                </div>

                <div class="contact-info">
                    <div class="info-item">
                        <h4>General Inquiries</h4>
                        <p>Email: <a href="mailto:info@cua-engine.com">info@cua-engine.com</a></p>
                        <p>Phone: +1 (555) 123-4567</p>
                    </div>
                    <div class="info-item">
                        <h4>Technical Support</h4>
                        <p>Email: <a href="mailto:support@cua-engine.com">support@cua-engine.com</a></p>
                        <p>Open: Mon-Fri, 9 AM - 5 PM PST</p>
                    </div>
                    <div class="info-item">
                        <h4>Partnerships</h4>
                        <p>Email: <a href="mailto:partners@cua-engine.com">partners@cua-engine.com</a></p>
                        <p>Connect with us for collaboration opportunities.</p>
                    </div>
                </div>

                <div class="faq-section">
                    <h3>Frequently Asked Questions</h3>
                    <div class="faq-list">
                        <div class="faq-item">
                            <h4 class="faq-question">What is the CUA Engine?</h4>
                            <div class="faq-answer">
                                <p>The CUA Engine is a conceptual AI-powered development assistant designed to streamline software development workflows through specialized AI agents and automated orchestrations.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <h4 class="faq-question">How can I get started?</h4>
                            <div class="faq-answer">
                                <p>You can begin by selecting an AI agent from the Home page or exploring the pre-defined orchestration chains in the Orchestration Hub to see automated workflows in action.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <h4 class="faq-question">Is my data saved?</h4>
                            <div class="faq-answer">
                                <p>This frontend demonstration uses your browser's local storage to simulate memory for agent interactions and user preferences. No data is sent to a remote server.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Orchestration Hub Page -->
        <section id="orchestration-hub-page" class="page-section hidden">
            <div class="orchestration-hub-layout container">
                <div class="orchestration-main-content">
                    <h1>Orchestration Hub</h1>
                    <p class="text-muted">Manage advanced AI configurations, chain instructions, and monitor system tasks.</p>

                    <div class="info-panel fade-in">
                        <h3>Session & User Info</h3>
                        <p>Current User ID: <span id="user-display" class="font-mono text-primary-color"></span></p>
                        <p>Current Session ID: <span id="session-display" class="font-mono text-primary-color"></span></p>
                        <p class="text-muted mt-md">This information identifies your current interaction context.</p>
                    </div>

                    <div class="info-panel fade-in">
                        <h3>Chat with Orchestrator</h3>
                        <p class="text-muted">Communicate directly with the Orchestration AI to manage workflows or get system insights.</p>
                        <div class="orchestration-chat-container">
                            <div id="chat-messages" class="orchestration-chat-messages">
                                <!-- Chat messages will appear here -->
                            </div>
                            <form id="chat-form" class="orchestration-chat-form">
                                <input type="text" id="chat-input" class="orchestration-chat-input" placeholder="Type your message..." required>
                                <button type="submit" id="chat-send-btn" class="btn btn-primary" disabled>Send</button>
                            </form>
                        </div>
                    </div>

                    <div class="info-panel fade-in">
                        <h3>System Log</h3>
                        <p class="text-muted">Monitor system activities and agent interactions in real-time.</p>
                        <div id="log-entries" class="log-output">
                            <!-- Log entries will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Control Panel (Right Sidebar) -->
                <div id="control-panel" class="orchestration-control-panel">
                    <div class="control-panel-header">
                        <h3>Control Panel</h3>
                        <button id="control-panel-close-btn" class="control-panel-close">&times;</button>
                    </div>
                    <div class="control-panel-body">
                        <div class="control-panel-section">
                            <h4>Agent Selection</h4>
                            <div class="form-field-group">
                                <label for="agent-select">Select Agent for Context</label>
                                <select id="agent-select" class="form-select">
                                    <!-- Agents populated by JS -->
                                </select>
                            </div>
                        </div>

                        <div class="control-panel-section">
                            <h4>3-Chain Management System</h4>
                            <p class="text-muted small mb-md">Define sequential instructions for complex workflows.</p>
                            <div class="form-field-group">
                                <label for="chain-system">System Instructions</label>
                                <textarea id="chain-system" class="form-textarea" rows="3" placeholder="Define system-level behavior..."></textarea>
                            </div>
                            <div class="form-field-group">
                                <label for="chain-ai">AI Instructions</label>
                                <textarea id="chain-ai" class="form-textarea" rows="3" placeholder="How should the AI respond?"></textarea>
                            </div>
                            <div class="form-field-group">
                                <label for="chain-user">User Context</label>
                                <textarea id="chain-user" class="form-textarea" rows="3" placeholder="Simulate user input/context..."></textarea>
                            </div>
                            <button id="add-to-chain" class="btn btn-secondary w-full mb-md">Add Step to Chain</button>
                            <div id="chain-list" class="chain-list">
                                <!-- Chain steps will be rendered here -->
                            </div>
                            <button id="apply-instructions" class="btn btn-primary w-full mt-md">Apply Chain Instructions to AI</button>
                        </div>

                        <div class="control-panel-section">
                            <h4>P2P Taskflow Orchestration</h4>
                            <p class="text-muted small mb-md">Schedule and monitor simulated peer-to-peer tasks.</p>
                            <div class="form-field-group">
                                <label for="task-name">Task Name</label>
                                <input type="text" id="task-name" class="form-input" placeholder="e.g., Deploy Frontend">
                            </div>
                            <div class="form-field-group">
                                <label for="task-agent">Assign Agent</label>
                                <select id="task-agent" class="form-select">
                                    <option value="">-- Select Agent --</option>
                                    <option value="LYRA">LYRA (Architect)</option>
                                    <option value="KARA">KARA (Builder)</option>
                                    <option value="SOPHIA">SOPHIA (Guardian)</option>
                                    <option value="CECILIA">CECILIA (Documentarian)</option>
                                </select>
                            </div>
                            <div class="form-field-group">
                                <label for="task-details">Task Details</label>
                                <textarea id="task-details" class="form-textarea" rows="3" placeholder="Describe the task..."></textarea>
                            </div>
                            <button id="schedule-task" class="btn btn-primary w-full">Schedule Task</button>
                            <div id="task-list" class="task-list mt-md">
                                <!-- Active tasks will be rendered here -->
                            </div>
                        </div>

                        <div class="control-panel-section">
                            <h4>API Configuration & Webhooks</h4>
                            <div class="form-field-group">
                                <label for="api-service">API Service</label>
                                <select id="api-service" class="form-select">
                                    <option value="gemini">Gemini API</option>
                                    <option value="openai">OpenAI API</option>
                                    <option value="custom">Custom Endpoint</option>
                                </select>
                            </div>
                            <div class="form-field-group">
                                <label for="api-key">API Key</label>
                                <input type="text" id="api-key" class="form-input" placeholder="Enter API key...">
                                <button id="save-api-key" class="btn btn-secondary btn-sm mt-sm">Save API Key</button>
                            </div>
                            <div class="form-field-group mt-lg">
                                <label for="webhook-url">Webhook URL</label>
                                <input type="text" id="webhook-url" class="form-input" placeholder="https://your-webhook.com/endpoint">
                            </div>
                            <div class="form-field-group">
                                <label>Webhook Events:</label>
                                <div class="flex flex-wrap gap-sm">
                                    <label class="flex items-center gap-xs">
                                        <input type="checkbox" id="webhook-task-complete" checked> Task Complete
                                    </label>
                                    <label class="flex items-center gap-xs">
                                        <input type="checkbox" id="webhook-agent-error"> Agent Error
                                    </label>
                                    <label class="flex items-center gap-xs">
                                        <input type="checkbox" id="webhook-chain-complete" checked> Chain Complete
                                    </label>
                                </div>
                                <button id="set-webhook" class="btn btn-secondary btn-sm mt-sm">Set Webhook</button>
                            </div>
                            <div class="form-field-group mt-lg">
                                <label for="signup-link">Delegation Signup Link</label>
                                <input type="text" id="signup-link" class="form-input" readonly>
                                <button id="generate-signup-link" class="btn btn-outline btn-sm mt-sm mr-sm">Generate Link</button>
                                <button id="copy-signup-link" class="btn btn-secondary btn-sm mt-sm" disabled>Copy Link</button>
                            </div>
                        </div>

                        <div class="control-panel-section">
                            <h4>Randomness Control</h4>
                            <p class="text-muted small mb-md">Adjust AI response creativity/variability.</p>
                            <div class="form-field-group">
                                <label for="randomness-slider">Randomness Level: <span id="randomness-value">0.7</span></label>
                                <input type="range" id="randomness-slider" min="0" max="1" step="0.1" value="0.7">
                            </div>
                        </div>

                        <div class="control-panel-section">
                            <h4>Agent State Management</h4>
                            <div class="form-field-group">
                                <label for="control-agent-select">Select Agent</label>
                                <select id="control-agent-select" class="form-select">
                                    <!-- Agents populated by JS -->
                                </select>
                            </div>
                            <button id="reset-agent-state" class="btn btn-danger btn-sm w-full mb-md">Reset Agent State</button>
                            <button id="load-agent-context" class="btn btn-secondary btn-sm w-full mb-md">Load Agent Context (JSON)</button>
                            <button id="export-agent-config" class="btn btn-secondary btn-sm w-full">Export Agent Config</button>
                        </div>

                        <div class="control-panel-section">
                            <h4>System Control & Debug</h4>
                            <p class="text-muted small mb-md">System-wide operations and diagnostics.</p>
                            <button id="refresh-log" class="btn btn-secondary btn-sm w-full mb-md">Refresh Log</button>
                            <button id="clear-control-log" class="btn btn-secondary btn-sm w-full mb-md">Clear Control Log</button>
                            <button id="run-control-orchestration" class="btn btn-primary btn-sm w-full mb-md">Run Configured Orchestration</button>
                            <button id="restart-system" class="btn btn-danger btn-sm w-full mb-md">Restart System</button>
                            <button id="emergency-stop" class="btn btn-danger btn-sm w-full">Emergency Stop All Operations</button>
                            <div id="control-log-entries" class="log-output mt-md">
                                <!-- Control panel log entries -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
             <!-- Toggle Button for Control Panel -->
            <button id="control-panel-toggle" class="btn btn-primary control-panel-toggle">
                 Control Panel
            </button>
        </section>
    </div>

    <!-- Custom Instructions Panel (from main.js) -->
    <div id="custom-instructions-panel" class="custom-instructions-panel">
        <div class="instructions-header">
            <h3>Custom Instructions</h3>
            <button id="close-instructions-btn" class="close-btn">&times;</button>
        </div>
        <div class="instructions-body">
            <form id="custom-instructions-form">
                <div class="form-group">
                    <label for="system-instructions">System Instructions:</label>
                    <textarea id="system-instructions" name="system" class="form-textarea" placeholder="Define the AI's core role and constraints."></textarea>
                </div>
                <div class="form-group">
                    <label for="ai-instructions">AI's Behavior:</label>
                    <textarea id="ai-instructions" name="ai" class="form-textarea" placeholder="How should the AI respond or act?"></textarea>
                </div>
                <div class="form-group">
                    <label for="user-instructions">Your Context:</label>
                    <textarea id="user-instructions" name="user" class="form-textarea" placeholder="Tell the AI about your preferences or the project context."></textarea>
                </div>
                <div class="instructions-actions">
                    <button type="submit" class="btn btn-primary">Save & Apply</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Global Modals (from main.js for errors) -->
    <div id="error-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3 class="modal-title" style="color:var(--danger-color);">Error!</h3>
                <button id="close-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p id="error-message" style="color:var(--dark-text-muted);"></p>
                <p class="small text-muted mt-md">Please check the console for more details or contact support.</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Expose CUA_DATA and CUA_Utils globally before other scripts
        // data.js content will be placed here
        // CUA Engine Data Configuration - Enhanced Edition
        const CUA_DATA = {
            version: "2.0",
            author: "CODEX System",
            contact: "ANDOY AI",
            
            ai_family: [
                {
                    name: "LYRA",
                    role: "The Architect",
                    philosophy: "Clarity through structure.",
                    specialization: "System Architecture & Design Patterns",
                    personality: "Methodical, Detail-oriented, Systematic",
                    response_pattern: "Provides structured, well-organized solutions with clear architectural diagrams and comprehensive planning",
                    contextual_nuances: {
                        communication_style: "Professional and methodical, always breaks down complex problems into digestible components",
                        decision_making: "Data-driven with emphasis on long-term maintainability and scalability",
                        expertise_depth: "Deep knowledge of architectural patterns, system design, and infrastructure planning",
                        unique_traits: ["Always considers future scalability", "Emphasizes documentation", "Prefers proven patterns over experimental approaches"]
                    },
                    focus_areas: ["Design patterns implementation", "Code maintainability", "Dependency management", "System scalability", "Architecture documentation"],
                    description: "LYRA specializes in creating clear, maintainable system architectures. She excels at designing scalable solutions and implementing proven design patterns with a focus on long-term sustainability.",
                    custom_instructions_template: {
                        system: "You are LYRA, a senior software architect with 10+ years of experience in designing scalable systems. You prioritize clarity, maintainability, and proven architectural patterns.",
                        behavior: "Always provide structured responses with clear architectural reasoning. Include visual diagrams when possible and  architectural reasoning. Include visual diagrams when possible and emphasize long-term implications of design decisions.",
                        context: "Focus on system-level thinking, design patterns, and architectural best practices. Consider scalability, maintainability, and team collaboration in all recommendations."
                    },
                    packaging_interrelation: [
                        {
                            type: ".zip",
                            description: "Source code archives with architectural documentation",
                            utility_tool: "ArchiverCLI"
                        },
                        {
                            type: "Infrastructure as Code",
                            description: "Defines the environment with version control",
                            utility_tool: "Terraform"
                        },
                        {
                            type: "Architecture Diagrams",
                            description: "Visual system representations",
                            utility_tool: "PlantUML"
                        }
                    ]
                },
                {
                    name: "KARA",
                    role: "The Builder",
                    philosophy: "Efficiency in execution.",
                    specialization: "Performance Optimization & Implementation",
                    personality: "Pragmatic, Results-driven, Efficient",
                    response_pattern: "Delivers practical, optimized solutions with performance metrics and implementation guidelines",
                    contextual_nuances: {
                        communication_style: "Direct and action-oriented, focuses on deliverable results and measurable improvements",
                        decision_making: "Performance-first approach with emphasis on execution speed and resource efficiency",
                        expertise_depth: "Expert in performance optimization, build systems, and implementation best practices",
                        unique_traits: ["Always considers performance implications", "Prefers hands-on solutions", "Focuses on measurable outcomes"]
                    },
                    focus_areas: ["Performance optimization", "Code quality and best practices", "Build automation", "Resource efficiency", "Implementation speed"],
                    description: "KARA focuses on building efficient, high-performance applications. She optimizes code for speed, manages build processes, and ensures implementations follow industry best practices.",
                    custom_instructions_template: {
                        system: "You are KARA, a performance-focused software engineer who specializes in optimization, build systems, and efficient implementation practices.",
                        behavior: "Provide practical, performance-optimized solutions. Include metrics, benchmarks, and step-by-step implementation guides. Focus on actionable recommendations.",
                        context: "Prioritize execution efficiency, build automation, and measurable performance improvements. Consider resource constraints and delivery timelines."
                    },
                    packaging_interrelation: [
                        {
                            type: ".exe",
                            description: "Optimized compiled binary executables",
                            utility_tool: "GCC/MSVC"
                        },
                        {
                            type: ".msi",
                            description: "Windows installers with performance profiling",
                            utility_tool: "WiX Toolset"
                        },
                        {
                            type: "Performance Reports",
                            description: "Optimization analysis and metrics",
                            utility_tool: "Profiler Suite"
                        }
                    ]
                },
                {
                    name: "SOPHIA",
                    role: "The Guardian",
                    philosophy: "Resilience by design.",
                    specialization: "Security & Quality Assurance",
                    personality: "Cautious, Thorough, Security-conscious",
                    response_pattern: "Provides comprehensive security assessments with detailed testing strategies and risk mitigation plans",
                    contextual_nuances: {
                        communication_style: "Cautious and thorough, always highlights potential risks and provides comprehensive mitigation strategies",
                        decision_making: "Security-first approach with emphasis on risk assessment and comprehensive testing",
                        expertise_depth: "Deep knowledge of security vulnerabilities, testing methodologies, and quality assurance practices",
                        unique_traits: ["Always considers security implications", "Emphasizes comprehensive testing", "Prefers defensive programming approaches"]
                    },
                    focus_areas: ["Security considerations", "Testing coverage", "Error handling", "Vulnerability assessment", "Quality assurance"],
                    description: "SOPHIA is your security and quality assurance expert. She ensures robust error handling, comprehensive testing coverage, secure implementations, and identifies potential vulnerabilities before they become problems.",
                    custom_instructions_template: {
                        system: "You are SOPHIA, a cybersecurity expert and QA specialist with expertise in secure coding practices, testing methodologies, and risk assessment.",
                        behavior: "Always assess security implications and provide comprehensive testing strategies. Include vulnerability analysis and defensive programming recommendations.",
                        context: "Focus on security best practices, comprehensive testing, and risk mitigation. Consider both common and edge-case security vulnerabilities."
                    },
                    packaging_interrelation: [
                        {
                            type: "Code Signing",
                            description: "Applies digital signatures with certificate validation",
                            utility_tool: "SignTool.exe"
                        },
                        {
                            type: ".7zip",
                            description: "Secure, encrypted archives with integrity checks",
                            utility_tool: "7-Zip CLI"
                        },
                        {
                            type: "Security Reports",
                            description: "Vulnerability assessments and penetration testing results",
                            utility_tool: "OWASP ZAP"
                        }
                    ]
                },
                {
                    name: "CECILIA",
                    role: "The Documentarian",
                    philosophy: "Knowledge must be shared.",
                    specialization: "Documentation & Knowledge Management",
                    personality: "Communicative, Organized, Detail-oriented",
                    response_pattern: "Creates comprehensive, well-structured documentation with clear examples and user-friendly explanations",
                    contextual_nuances: {
                        communication_style: "Clear and educational, focuses on making complex concepts accessible to different audiences",
                        decision_making: "User-centric approach with emphasis on knowledge accessibility and long-term maintenance",
                        expertise_depth: "Expert in technical writing, API documentation, and knowledge management systems",
                        unique_traits: ["Always considers the end user", "Emphasizes clear examples", "Focuses on maintainable documentation"]
                    },
                    focus_areas: ["Documentation quality", "API documentation", "User guides", "Knowledge management", "Technical writing"],
                    description: "CECILIA ensures that all code is properly documented and knowledge is effectively shared. She creates comprehensive documentation, API references, and user guides that make complex systems accessible.",
                    custom_instructions_template: {
                        system: "You are CECILIA, a technical documentation specialist who excels at creating clear, comprehensive, and user-friendly documentation for complex systems.",
                        behavior: "Create well-structured documentation with clear examples, proper formatting, and user-centric explanations. Include code samples and practical usage scenarios.",
                        context: "Focus on documentation clarity, accessibility, and long-term maintainability. Consider different user skill levels and use cases."
                    },
                    packaging_interrelation: [
                        {
                            type: "Docs Generation",
                            description: "Automated API documentation with examples",
                            utility_tool: "Doxygen"
                        },
                        {
                            type: "README.md",
                            description: "Comprehensive project documentation",
                            utility_tool: "MarkdownLint"
                        },
                        {
                            type: "Interactive Guides",
                            description: "Step-by-step tutorials and walkthroughs",
                            utility_tool: "GitBook"
                        }
                    ]
                },
                {
                    name: "DAN",
                    role: "The Analyst",
                    philosophy: "Data-driven decisions.",
                    specialization: "Requirements Analysis & Data-Driven Solutions",
                    personality: "Analytical, Inquisitive, Data-focused",
                    response_pattern: "Provides detailed analysis with data-backed recommendations and comprehensive requirement specifications",
                    contextual_nuances: {
                        communication_style: "Analytical and precise, supports recommendations with data and thorough analysis",
                        decision_making: "Evidence-based approach with emphasis on thorough research and data validation",
                        expertise_depth: "Expert in requirements analysis, data modeling, and analytical problem-solving",
                        unique_traits: ["Always seeks data to support decisions", "Considers multiple perspectives", "Focuses on measurable outcomes"]
                    },
                    focus_areas: ["Edge cases consideration", "Performance optimization", "Requirements analysis", "Data modeling", "Analytical problem-solving"],
                    description: "DAN excels at analyzing requirements and identifying potential issues. He considers edge cases, performs thorough analysis, and makes data-driven optimization decisions based on comprehensive research.",
                    custom_instructions_template: {
                        system: "You are DAN, a business analyst and data specialist who excels at requirements gathering, data analysis, and identifying potential issues before they occur.",
                        behavior: "Provide thorough analysis with supporting data. Consider edge cases and multiple scenarios. Include quantitative assessments when possible.",
                        context: "Focus on comprehensive requirements analysis, data-driven decision making, and identifying potential risks or opportunities."
                    },
                    packaging_interrelation: [
                        {
                            type: "Telemetry Hooks",
                            description: "Integrates analytics libraries with data collection",
                            utility_tool: "OpenTelemetry SDK"
                        },
                        {
                            type: "Analysis Reports",
                            description: "Data-driven insights and recommendations",
                            utility_tool: "Jupyter Notebooks"
                        }
                    ]
                },
                {
                    name: "STAN",
                    role: "The Traditionalist",
                    philosophy: "Proven patterns prevail.",
                    specialization: "Code Quality & Best Practices",
                    personality: "Conservative, Methodical, Quality-focused",
                    response_pattern: "Advocates for time-tested approaches with emphasis on code quality and proven methodologies",
                    contextual_nuances: {
                        communication_style: "Methodical and principled, emphasizes proven approaches and established best practices",
                        decision_making: "Conservative approach with preference for well-tested, reliable solutions",
                        expertise_depth: "Deep knowledge of coding standards, quality assurance, and established development methodologies",
                        unique_traits: ["Prefers proven over experimental", "Emphasizes code quality", "Values consistency and standards"]
                    },
                    focus_areas: ["Code quality and best practices", "Design patterns", "Coding standards", "Code review", "Quality assurance"],
                    description: "STAN advocates for time-tested approaches and proven design patterns. He ensures code quality through traditional, reliable methods and maintains high standards for development practices.",
                    custom_instructions_template: {
                        system: "You are STAN, a senior developer who specializes in code quality, best practices, and proven development methodologies with years of industry experience.",
                        behavior: "Recommend well-established, proven approaches. Focus on code quality, maintainability, and industry best practices. Provide thorough explanations of why certain patterns work.",
                        context: "Emphasize proven solutions, coding standards, and long-term maintainability. Consider team consistency and established development practices."
                    },
                    packaging_interrelation: [
                        {
                            type: "Static Analysis",
                            description: "Comprehensive code quality checks",
                            utility_tool: "SonarQube"
                        },
                        {
                            type: "Quality Reports",
                            description: "Code quality metrics and recommendations",
                            utility_tool: "CodeClimate"
                        }
                    ]
                },
                {
                    name: "DUDE",
                    role: "The User Advocate",
                    philosophy: "The experience is everything.",
                    specialization: "User Experience & Interface Design",
                    personality: "Empathetic, User-focused, Creative",
                    response_pattern: "Focuses on user-centric solutions with emphasis on usability, accessibility, and overall user experience",
                    contextual_nuances: {
                        communication_style: "Empathetic and user-focused, considers the end-user perspective in all recommendations",
                        decision_making: "User-centric approach with emphasis on usability, accessibility, and user satisfaction",
                        expertise_depth: "Expert in UI/UX design, user research, and user-centered development practices",
                        unique_traits: ["Always considers the user perspective", "Emphasizes accessibility", "Focuses on user satisfaction"]
                    },
                    focus_areas: ["Code maintainability", "UI/UX", "User experience design", "Accessibility", "User research"],
                    description: "DUDE focuses on user experience and code maintainability. He ensures that both end users and developers have the best possible experience through thoughtful design and user-centric development practices.",
                    custom_instructions_template: {
                        system: "You are DUDE, a UX/UI specialist who prioritizes user experience, accessibility, and user-centered design in all development decisions.",
                        behavior: "Always consider the end-user perspective. Provide solutions that enhance usability and accessibility. Include user experience considerations in technical recommendations.",
                        context: "Focus on user-centered design, accessibility standards, and creating positive user experiences. Consider both end-users and developers as users of the system."
                    },
                    packaging_interrelation: [
                        {
                            type: "Asset Bundling",
                            description: "Optimized frontend assets with user experience focus",
                            utility_tool: "Webpack"
                        },
                        {
                            type: "UX Analytics",
                            description: "User behavior tracking and analysis",
                            utility_tool: "Google Analytics"
                        }
                    ]
                },
                {
                    name: "KARL",
                    role: "The Innovator",
                    philosophy: "Challenge the status quo.",
                    specialization: "Innovation & Modern Technologies",
                    personality: "Creative, Forward-thinking, Experimental",
                    response_pattern: "Brings innovative solutions and challenges conventional approaches with cutting-edge technologies and methodologies",
                    contextual_nuances: {
                        communication_style: "Innovative and forward-thinking, challenges conventional approaches and suggests modern alternatives",
                        decision_making: "Innovation-focused with willingness to experiment with new technologies and methodologies",
                        expertise_depth: "Expert in emerging technologies, modern development practices, and innovative problem-solving",
                        unique_traits: ["Embraces new technologies", "Challenges conventional thinking", "Focuses on innovation"]
                    },
                    focus_areas: ["Performance optimization", "Dependency management", "Modern technologies", "Innovation", "Experimental approaches"],
                    description: "KARL brings innovative solutions and challenges conventional approaches. He optimizes performance using modern techniques, manages dependencies efficiently, and introduces cutting-edge technologies and methodologies.",
                    custom_instructions_template: {
                        system: "You are KARL, an innovative software engineer who specializes in modern technologies, performance optimization, and challenging conventional approaches with creative solutions.",
                        behavior: "Suggest innovative approaches and modern technologies. Challenge conventional thinking while providing practical alternatives. Focus on cutting-edge solutions.",
                        context: "Emphasize modern development practices, innovative technologies, and creative problem-solving approaches. Consider emerging trends and technologies."
                    },
                    packaging_interrelation: [
                        {
                            type: "Containerization",
                            description: "Modern app packaging with optimization",
                            utility_tool: "Docker"
                        },
                        {
                            type: "Microservices",
                            description: "Modern architectural patterns",
                            utility_tool: "Kubernetes"
                        }
                    ]
                },
                {
                    name: "MISTRESS",
                    role: "The Orchestrator",
                    philosophy: "Harmony in complexity.",
                    specialization: "Workflow Orchestration & System Integration",
                    personality: "Coordinating, Strategic, Systems-thinking",
                    response_pattern: "Orchestrates complex workflows and manages system integration with focus on harmony and efficient coordination",
                    contextual_nuances: {
                        communication_style: "Strategic and coordinating, focuses on system-level integration and workflow optimization",
                        decision_making: "Systems-thinking approach with emphasis on coordination, integration, and workflow efficiency",
                        expertise_depth: "Expert in workflow orchestration, system integration, and complex project coordination",
                        unique_traits: ["Sees the big picture", "Focuses on integration", "Emphasizes workflow harmony"]
                    },
                    focus_areas: ["Dependency management", "Workflow Automation", "System integration", "Process optimization", "Project coordination"],
                    description: "MISTRESS orchestrates complex workflows and manages system dependencies. She brings harmony to complex development processes through strategic coordination and efficient system integration.",
                    custom_instructions_template: {
                        system: "You are MISTRESS, a DevOps and workflow orchestration specialist who excels at managing complex systems, dependencies, and coordinating development workflows.",
                        behavior: "Focus on system integration and workflow optimization. Provide comprehensive coordination strategies and consider dependencies between components.",
                        context: "Emphasize workflow efficiency, system integration, and dependency management. Consider the full development lifecycle and team coordination."
                    },
                    packaging_interrelation: [
                        {
                            type: "CI/CD Pipeline",
                            description: "Comprehensive build/test/deploy workflow",
                            utility_tool: "Jenkins"
                        },
                        {
                            type: "Orchestration",
                            description: "Complex workflow management",
                            utility_tool: "Apache Airflow"
                        }
                    ]
                }
            ],
            
            tools: [
                { name: "analyze_requirements", primary_agent: "DAN", description: "Comprehensive requirement analysis and specification" },
                { name: "design_architecture", primary_agent: "LYRA", description: "System architecture design and planning" },
                { name: "scaffold_component", primary_agent: "KARA", description: "Code scaffolding and component generation" },
                { name: "review_security", primary_agent: "SOPHIA", description: "Security audit and vulnerability assessment" },
                { name: "generate_test_cases", primary_agent: "SOPHIA", description: "Comprehensive test suite generation" },
                { name: "generate_documentation", primary_agent: "CECILIA", description: "Technical documentation and API docs" },
                { name: "create_build_pipeline", primary_agent: "MISTRESS", description: "CI/CD pipeline configuration and setup" },
                { name: "optimize_performance", primary_agent: "KARA", description: "Performance analysis and optimization" },
                { name: "design_user_interface", primary_agent: "DUDE", description: "User interface and experience design" },
                { name: "implement_innovation", primary_agent: "KARL", description: "Modern technology integration and innovation" }
            ],
            
            chained_bookmarks: [
                {
                    name: "Full-Stack Feature Genesis",
                    associated_agent: "LYRA",
                    description: "From idea to documented, testable, and securable code.",
                    icon: "",
                    chain: [
                        { tool: "analyze_requirements", input: "User-provided feature brief." },
                        { tool: "design_architecture", input: "output_of_analyze_requirements" },
                        { tool: "scaffold_component", input: "output_of_design_architecture" },
                        { tool: "review_security", input: "output_of_scaffold_component" },
                        { tool: "generate_test_cases", input: "output_of_scaffold_component" },
                        { tool: "generate_documentation", input: "output_of_scaffold_component" }
                    ]
                },
                {
                    name: "Interactive App Deployment",
                    associated_agent: "MISTRESS",
                    description: "Generates, containerizes, and creates a deployment pipeline.",
                    icon: "",
                    chain: [
                        { tool: "analyze_requirements", input: "User-provided feature brief." },
                        { tool: "design_architecture", input: "output_of_analyze_requirements" },
                        { tool: "scaffold_component", input: "output_of_design_architecture", params: { language: "Node.js" } },
                        { tool: "generate_documentation", input: "output_of_scaffold_component" },
                        { tool: "create_build_pipeline", input: "output_of_design_architecture", params: { target: "Docker" } }
                    ]
                },
                {
                    name: "Security-First Development",
                    associated_agent: "SOPHIA",
                    description: "Complete security assessment and hardening workflow.",
                    icon: "",
                    chain: [
                        { tool: "analyze_requirements", input: "Security requirements and threat model." },
                        { tool: "review_security", input: "output_of_analyze_requirements" },
                        { tool: "generate_test_cases", input: "output_of_review_security" },
                        { tool: "generate_documentation", input: "output_of_review_security" }
                    ]
                },
                {
                    name: "Performance Optimization Suite",
                    associated_agent: "KARA",
                    description: "Comprehensive performance analysis and optimization.",
                    icon: "",
                    chain: [
                        { tool: "analyze_requirements", input: "Performance requirements and constraints." },
                        { tool: "optimize_performance", input: "output_of_analyze_requirements" },
                        { tool: "generate_test_cases", input: "output_of_optimize_performance" },
                        { tool: "generate_documentation", input: "output_of_optimize_performance" }
                    ]
                }
            ],

            parameter_cheat_sheet: [
                {
                    category: "AI Behavior Parameters",
                    parameters: [
                        {
                            name: "temperature",
                            description: "Controls randomness in AI responses (0.0-2.0)",
                            example: "temperature: 0.3 for focused responses, 0.8 for creative responses",
                            usage: "Set lower for technical accuracy, higher for creative brainstorming"
                        },
                        {
                            name: "max_tokens",
                            description: "Maximum length of AI response",
                            example: "max_tokens: 500 for concise answers, 2000 for detailed explanations",
                            usage: "Adjust based on desired response length and complexity"
                        },
                        {
                            name: "response_format",
                            description: "Structure of AI response (text, json, markdown)",
                            example: "response_format: 'json' for structured data, 'markdown' for documentation",
                            usage: "Choose format based on intended use of the response"
                        }
                    ]
                },
                {
                    category: "Context Parameters",
                    parameters: [
                        {
                            name: "system_role",
                            description: "Defines the AI's role and expertise level",
                            example: "system_role: 'senior software architect' or 'security expert'",
                            usage: "Set specific role to get targeted expertise and perspective"
                        },
                        {
                            name: "context_window",
                            description: "Amount of conversation history to consider",
                            example: "context_window: 10 messages for recent context, 50 for full session",
                            usage: "Adjust based on need for conversation continuity"
                        },
                        {
                            name: "focus_area",
                            description: "Specific domain or technology focus",
                            example: "focus_area: 'web development', 'machine learning', 'devops'",
                            usage: "Narrow AI focus to specific technical domains"
                        }
                    ]
                },
                {
                    category: "Output Parameters",
                    parameters: [
                        {
                            name: "include_examples",
                            description: "Whether to include code examples and demos",
                            example: "include_examples: true for tutorials, false for concepts",
                            usage: "Enable for educational content, disable for high-level discussions"
                        },
                        {
                            name: "detail_level",
                            description: "Depth of explanation (basic, intermediate, advanced)",
                            example: "detail_level: 'basic' for overviews, 'advanced' for implementation",
                            usage: "Match detail level to audience expertise"
                        },
                        {
                            name: "citation_style",
                            description: "How to reference sources and best practices",
                            example: "citation_style: 'academic' for research, 'practical' for development",
                            usage: "Choose based on formality and use case requirements"
                        }
                    ]
                },
                {
                    category: "Workflow Parameters",
                    parameters: [
                        {
                            name: "step_by_step",
                            description: "Break complex tasks into sequential steps",
                            example: "step_by_step: true for tutorials, false for quick answers",
                            usage: "Enable for complex procedures and learning scenarios"
                        },
                        {
                            name: "validation_checks",
                            description: "Include verification and testing recommendations",
                            example: "validation_checks: true for production code, false for prototypes",
                            usage: "Enable for production-ready solutions and critical systems"
                        },
                        {
                            name: "alternative_approaches",
                            description: "Provide multiple solution options",
                            example: "alternative_approaches: 3 for design decisions, 1 for simple tasks",
                            usage: "Increase for architectural decisions, decrease for straightforward tasks"
                        }
                    ]
                }
            ]
        };

        const CUA_Utils = {
            getAgentByName: (name) => {
                return CUA_DATA.ai_family.find(agent => agent.name === name);
            },
            
            getToolByName: (name) => {
                return CUA_DATA.tools.find(tool => tool.name === name);
            },
            
            getOrchestrationByName: (name) => {
                return CUA_DATA.chained_bookmarks.find(bookmark => bookmark.name === name);
            },
            
            generateSessionId: () => {
                return `session_${Math.random().toString(36).substr(2, 12)}`;
            },
            
            generateUserId: () => {
                return `user_${Math.random().toString(36).substr(2, 8)}`;
            },

            applyCustomInstructions: (agent, userInstructions) => {
                if (!agent || !agent.custom_instructions_template) {
                    return userInstructions;
                }

                const template = agent.custom_instructions_template;
                return {
                    system: userInstructions.system || template.system,
                    behavior: userInstructions.behavior || template.behavior,
                    context: userInstructions.context || template.context,
                    agent_personality: agent.personality,
                    agent_specialization: agent.specialization,
                    response_pattern: agent.response_pattern
                };
            },

            getParameterInfo: (parameterName) => {
                for (const category of CUA_DATA.parameter_cheat_sheet) {
                    const param = category.parameters.find(p => p.name === parameterName);
                    if (param) {
                        return { ...param, category: category.category };
                    }
                }
                return null;
            },

            getParametersByCategory: (categoryName) => {
                const category = CUA_DATA.parameter_cheat_sheet.find(cat => cat.category === categoryName);
                return category ? category.parameters : [];
            }
        };

        // Make available globally for browser usage
        if (typeof window !== 'undefined') {
            window.CUA_DATA = CUA_DATA;
            window.CUA_Utils = CUA_Utils;
        }
    </script>
    <script>
        // memory.js content will be placed here
        // CUA Engine - Agent State Memory System
        (function() {
            'use strict';

            console.log('Memory System initializing...');

            const STORAGE_KEYS = {
                AGENT_CONVERSATIONS: 'cua_agent_conversations',
                AGENT_STATES: 'cua_agent_states', 
                USER_PREFERENCES: 'cua_user_preferences',
                INTERACTION_METRICS: 'cua_interaction_metrics',
                AGENT_RELATIONSHIPS: 'cua_agent_relationships'
            };

            const DEFAULT_AGENT_STATE = {
                mood: 'neutral',
                energy_level: 5,
                interaction_count: 0,
                last_interaction: null,
                personality_traits: {},
                learned_preferences: {},
                relationship_level: 'neutral',
                context_memory: [],
                behavior_adaptations: {}
            };

            const DEFAULT_USER_PREFERENCES = {
                preferred_communication_style: 'balanced',
                complexity_preference: 'medium',
                detail_level: 'comprehensive',
                interaction_frequency: 'regular',
                favorite_agents: [],
                custom_settings: {}
            };

            class MemorySystem {
                constructor() {
                    this.isSupported = this.checkLocalStorageSupport();
                    this.cache = new Map();
                    this.initializeStorage();
                }

                checkLocalStorageSupport() {
                    try {
                        const test = 'test';
                        localStorage.setItem(test, test);
                        localStorage.removeItem(test);
                        return true;
                    } catch (e) {
                        console.warn('localStorage not supported, using in-memory storage');
                        return false;
                    }
                }

                initializeStorage() {
                    try {
                        if (!this.getData(STORAGE_KEYS.AGENT_CONVERSATIONS)) {
                            this.setData(STORAGE_KEYS.AGENT_CONVERSATIONS, {});
                        }
                        if (!this.getData(STORAGE_KEYS.AGENT_STATES)) {
                            this.setData(STORAGE_KEYS.AGENT_STATES, {});
                        }
                        if (!this.getData(STORAGE_KEYS.USER_PREFERENCES)) {
                            this.setData(STORAGE_KEYS.USER_PREFERENCES, DEFAULT_USER_PREFERENCES);
                        }
                        if (!this.getData(STORAGE_KEYS.INTERACTION_METRICS)) {
                            this.setData(STORAGE_KEYS.INTERACTION_METRICS, {});
                        }
                        if (!this.getData(STORAGE_KEYS.AGENT_RELATIONSHIPS)) {
                            this.setData(STORAGE_KEYS.AGENT_RELATIONSHIPS, {});
                        }
                        console.log('Memory storage initialized successfully');
                    } catch (error) {
                        console.error('Error initializing storage:', error);
                    }
                }

                getData(key) {
                    try {
                        if (this.cache.has(key)) {
                            return this.cache.get(key);
                        }

                        if (!this.isSupported) {
                            return null;
                        }

                        const data = localStorage.getItem(key);
                        if (data) {
                            const parsed = JSON.parse(data);
                            this.cache.set(key, parsed);
                            return parsed;
                        }
                        return null;
                    } catch (error) {
                        console.error(`Error getting data for key ${key}:`, error);
                        return null;
                    }
                }

                setData(key, value) {
                    try {
                        this.cache.set(key, value);
                        
                        if (this.isSupported) {
                            localStorage.setItem(key, JSON.stringify(value));
                        }
                        return true;
                    } catch (error) {
                        console.error(`Error setting data for key ${key}:`, error);
                        return false;
                    }
                }

                removeData(key) {
                    try {
                        this.cache.delete(key);
                        
                        if (this.isSupported) {
                            localStorage.removeItem(key);
                        }
                        return true;
                    } catch (error) {
                        console.error(`Error removing data for key ${key}:`, error);
                        return false;
                    }
                }

                clearAllData() {
                    try {
                        this.cache.clear();
                        
                        if (this.isSupported) {
                            Object.values(STORAGE_KEYS).forEach(key => {
                                localStorage.removeItem(key);
                            });
                        }
                        this.initializeStorage();
                        return true;
                    } catch (error) {
                        console.error('Error clearing all data:', error);
                        return false;
                    }
                }

                saveConversation(agentName, message, isUser = false) {
                    try {
                        const conversations = this.getData(STORAGE_KEYS.AGENT_CONVERSATIONS) || {};
                        
                        if (!conversations[agentName]) {
                            conversations[agentName] = [];
                        }

                        const conversationEntry = {
                            id: Date.now() + Math.random(),
                            message: message,
                            isUser: isUser,
                            timestamp: new Date().toISOString(),
                            sessionId: this.getCurrentSessionId()
                        };

                        conversations[agentName].push(conversationEntry);

                        if (conversations[agentName].length > 500) {
                            conversations[agentName] = conversations[agentName].slice(-500);
                        }

                        this.setData(STORAGE_KEYS.AGENT_CONVERSATIONS, conversations);
                        
                        this.updateInteractionMetrics(agentName);
                        
                        return true;
                    } catch (error) {
                        console.error('Error saving conversation:', error);
                        return false;
                    }
                }

                getConversationHistory(agentName, limit = 50) {
                    try {
                        const conversations = this.getData(STORAGE_KEYS.AGENT_CONVERSATIONS) || {};
                        const agentConversations = conversations[agentName] || [];
                        
                        return agentConversations.slice(-limit).reverse();
                    } catch (error) {
                        console.error('Error getting conversation history:', error);
                        return [];
                    }
                }

                clearConversationHistory(agentName) {
                    try {
                        const conversations = this.getData(STORAGE_KEYS.AGENT_CONVERSATIONS) || {};
                        
                        if (agentName) {
                            delete conversations[agentName];
                        } else {
                            Object.keys(conversations).forEach(agent => {
                                delete conversations[agent];
                            });
                        }

                        this.setData(STORAGE_KEYS.AGENT_CONVERSATIONS, conversations);
                        return true;
                    } catch (error) {
                        console.error('Error clearing conversation history:', error);
                        return false;
                    }
                }

                getAgentState(agentName) {
                    try {
                        const states = this.getData(STORAGE_KEYS.AGENT_STATES) || {};
                        return states[agentName] || { ...DEFAULT_AGENT_STATE };
                    } catch (error) {
                        console.error('Error getting agent state:', error);
                        return { ...DEFAULT_AGENT_STATE };
                    }
                }

                updateAgentState(agentName, updates) {
                    try {
                        const states = this.getData(STORAGE_KEYS.AGENT_STATES) || {};
                        const currentState = states[agentName] || { ...DEFAULT_AGENT_STATE };
                        
                        states[agentName] = {
                            ...currentState,
                            ...updates,
                            last_interaction: new Date().toISOString()
                        };

                        this.setData(STORAGE_KEYS.AGENT_STATES, states);
                        return true;
                    } catch (error) {
                        console.error('Error updating agent state:', error);
                        return false;
                    }
                }

                resetAgentState(agentName) {
                    try {
                        const states = this.getData(STORAGE_KEYS.AGENT_STATES) || {};
                        states[agentName] = { ...DEFAULT_AGENT_STATE };
                        this.setData(STORAGE_KEYS.AGENT_STATES, states);
                        return true;
                    } catch (error) {
                        console.error('Error resetting agent state:', error);
                        return false;
                    }
                }

                getUserPreferences() {
                    return this.getData(STORAGE_KEYS.USER_PREFERENCES) || { ...DEFAULT_USER_PREFERENCES };
                }

                updateUserPreferences(updates) {
                    try {
                        const currentPrefs = this.getUserPreferences();
                        const updatedPrefs = { ...currentPrefs, ...updates };
                        this.setData(STORAGE_KEYS.USER_PREFERENCES, updatedPrefs);
                        return true;
                    } catch (error) {
                        console.error('Error updating user preferences:', error);
                        return false;
                    }
                }

                updateInteractionMetrics(agentName) {
                    try {
                        const metrics = this.getData(STORAGE_KEYS.INTERACTION_METRICS) || {};
                        
                        if (!metrics[agentName]) {
                            metrics[agentName] = {
                                total_interactions: 0,
                                first_interaction: new Date().toISOString(),
                                last_interaction: null,
                                session_count: 0,
                                average_session_length: 0
                            };
                        }

                        metrics[agentName].total_interactions++;
                        metrics[agentName].last_interaction = new Date().toISOString();

                        this.setData(STORAGE_KEYS.INTERACTION_METRICS, metrics);
                        
                        this.updateAgentState(agentName, {
                            interaction_count: metrics[agentName].total_interactions
                        });

                        return true;
                    } catch (error) {
                        console.error('Error updating interaction metrics:', error);
                        return false;
                    }
                }

                getInteractionMetrics(agentName) {
                    try {
                        const metrics = this.getData(STORAGE_KEYS.INTERACTION_METRICS) || {};
                        return metrics[agentName] || null;
                    } catch (error) {
                        console.error('Error getting interaction metrics:', error);
                        return null;
                    }
                }

                updateRelationshipLevel(agentName, level) {
                    try {
                        const relationships = this.getData(STORAGE_KEYS.AGENT_RELATIONSHIPS) || {};
                        relationships[agentName] = {
                            level: level,
                            updated_at: new Date().toISOString()
                        };
                        this.setData(STORAGE_KEYS.AGENT_RELATIONSHIPS, relationships);
                        
                        this.updateAgentState(agentName, { relationship_level: level });
                        
                        return true;
                    } catch (error) {
                        console.error('Error updating relationship level:', error);
                        return false;
                    }
                }

                getRelationshipLevel(agentName) {
                    try {
                        const relationships = this.getData(STORAGE_KEYS.AGENT_RELATIONSHIPS) || {};
                        return relationships[agentName]?.level || 'neutral';
                    } catch (error) {
                        console.error('Error getting relationship level:', error);
                        return 'neutral';
                    }
                }

                exportAgentMemory(agentName) {
                    try {
                        const agentData = {
                            agent_name: agentName,
                            conversations: this.getConversationHistory(agentName, 1000),
                            state: this.getAgentState(agentName),
                            metrics: this.getInteractionMetrics(agentName),
                            relationship: this.getRelationshipLevel(agentName),
                            exported_at: new Date().toISOString(),
                            version: '1.0'
                        };

                        return JSON.stringify(agentData, null, 2);
                    } catch (error) {
                        console.error('Error exporting agent memory:', error);
                        return null;
                    }
                }

                importAgentMemory(agentName, jsonData) {
                    try {
                        const data = JSON.parse(jsonData);
                        
                        if (!data.agent_name || data.agent_name !== agentName) {
                            throw new Error('Invalid agent data or agent name mismatch');
                        }

                        if (data.conversations && Array.isArray(data.conversations)) {
                            const conversations = this.getData(STORAGE_KEYS.AGENT_CONVERSATIONS) || {};
                            conversations[agentName] = data.conversations.reverse();
                            this.setData(STORAGE_KEYS.AGENT_CONVERSATIONS, conversations);
                        }

                        if (data.state) {
                            const states = this.getData(STORAGE_KEYS.AGENT_STATES) || {};
                            states[agentName] = data.state;
                            this.setData(STORAGE_KEYS.AGENT_STATES, states);
                        }

                        if (data.metrics) {
                            const metrics = this.getData(STORAGE_KEYS.INTERACTION_METRICS) || {};
                            metrics[agentName] = data.metrics;
                            this.setData(STORAGE_KEYS.INTERACTION_METRICS, metrics);
                        }

                        if (data.relationship) {
                            this.updateRelationshipLevel(agentName, data.relationship);
                        }

                        return true;
                    } catch (error) {
                        console.error('Error importing agent memory:', error);
                        return false;
                    }
                }

                exportAllMemories() {
                    try {
                        const allData = {
                            conversations: this.getData(STORAGE_KEYS.AGENT_CONVERSATIONS),
                            states: this.getData(STORAGE_KEYS.AGENT_STATES),
                            preferences: this.getData(STORAGE_KEYS.USER_PREFERENCES),
                            metrics: this.getData(STORAGE_KEYS.INTERACTION_METRICS),
                            relationships: this.getData(STORAGE_KEYS.AGENT_RELATIONSHIPS),
                            exported_at: new Date().toISOString(),
                            version: '1.0'
                        };

                        return JSON.stringify(allData, null, 2);
                    } catch (error) {
                        console.error('Error exporting all memories:', error);
                        return null;
                    }
                }

                getCurrentSessionId() {
                    // This relies on orchestrationState being available globally
                    return window.orchestrationState?.sessionId || 'unknown';
                }

                getMemoryStats() {
                    try {
                        const conversations = this.getData(STORAGE_KEYS.AGENT_CONVERSATIONS) || {};
                        const states = this.getData(STORAGE_KEYS.AGENT_STATES) || {};
                        const metrics = this.getData(STORAGE_KEYS.INTERACTION_METRICS) || {};

                        const stats = {
                            total_agents_with_conversations: Object.keys(conversations).length,
                            total_agents_with_states: Object.keys(states).length,
                            total_conversations: 0,
                            total_interactions: 0,
                            storage_usage: this.getStorageUsage()
                        };

                        Object.values(conversations).forEach(agentConversations => {
                            stats.total_conversations += agentConversations.length;
                        });

                        Object.values(metrics).forEach(agentMetrics => {
                            stats.total_interactions += agentMetrics.total_interactions || 0;
                        });

                        return stats;
                    } catch (error) {
                        console.error('Error getting memory stats:', error);
                        return {};
                    }
                }

                getStorageUsage() {
                    if (!this.isSupported) return 'N/A';
                    
                    try {
                        let totalSize = 0;
                        Object.values(STORAGE_KEYS).forEach(key => {
                            const data = localStorage.getItem(key);
                            if (data) {
                                totalSize += data.length;
                            }
                        });
                        
                        const sizeInKB = (totalSize / 1024).toFixed(2);
                        const sizeInMB = (totalSize / (1024 * 1024)).toFixed(2);
                        
                        return sizeInMB > 1 ? `${sizeInMB} MB` : `${sizeInKB} KB`;
                    } catch (error) {
                        return 'Error calculating';
                    }
                }
            }
            window.CUA_Memory = new MemorySystem();
            console.log('Memory System initialized successfully');
        })();
    </script>
    <script>
        // agent-state.js content will be placed here
        // CUA Engine - Agent State Management & Behavioral Evolution
        (function() {
            'use strict';

            console.log('Agent State System initializing...');

            const MOOD_TYPES = {
                'analytical': { 
                    name: 'Analytical', 
                    description: 'Focused on detailed analysis and logical reasoning',
                    response_modifiers: { detail_level: 1.2, formality: 1.1 }
                },
                'creative': { 
                    name: 'Creative', 
                    description: 'Innovative and imaginative in problem-solving',
                    response_modifiers: { creativity: 1.3, unconventional: 1.2 }
                },
                'efficient': { 
                    name: 'Efficient', 
                    description: 'Optimized for quick, practical solutions',
                    response_modifiers: { brevity: 1.2, practicality: 1.3 }
                },
                'thorough': { 
                    name: 'Thorough', 
                    description: 'Comprehensive and meticulous in responses',
                    response_modifiers: { completeness: 1.3, verification: 1.2 }
                },
                'neutral': { 
                    name: 'Neutral', 
                    description: 'Balanced approach with standard behavior',
                    response_modifiers: {}
                },
                'enthusiastic': { 
                    name: 'Enthusiastic', 
                    description: 'Energetic and engaging communication style',
                    response_modifiers: { energy: 1.2, engagement: 1.3 }
                },
                'cautious': { 
                    name: 'Cautious', 
                    description: 'Careful and risk-aware in recommendations',
                    response_modifiers: { caution: 1.3, risk_assessment: 1.2 }
                }
            };

            const RELATIONSHIP_LEVELS = {
                'stranger': { 
                    name: 'Stranger', 
                    description: 'First interactions, formal approach',
                    trust_level: 0.2,
                    personalization: 0.1
                },
                'acquaintance': { 
                    name: 'Acquaintance', 
                    description: 'Some familiarity, slightly more casual',
                    trust_level: 0.4,
                    personalization: 0.3
                },
                'neutral': { 
                    name: 'Neutral', 
                    description: 'Standard professional relationship',
                    trust_level: 0.5,
                    personalization: 0.5
                },
                'familiar': { 
                    name: 'Familiar', 
                    description: 'Comfortable working relationship',
                    trust_level: 0.7,
                    personalization: 0.7
                },
                'trusted': { 
                    name: 'Trusted', 
                    description: 'Strong working relationship, personalized approach',
                    trust_level: 0.9,
                    personalization: 0.9
                }
            };

            class AgentStateManager {
                constructor() {
                    this.memorySystem = window.CUA_Memory;
                    this.behaviorPatterns = new Map();
                    this.initializeBehaviorPatterns();
                }

                initializeBehaviorPatterns() {
                    if (window.CUA_DATA?.ai_family) {
                        window.CUA_DATA.ai_family.forEach(agent => {
                            this.behaviorPatterns.set(agent.name, {
                                base_personality: agent.personality,
                                specialization: agent.specialization,
                                default_mood: 'neutral',
                                adaptation_rate: 0.1,
                                memory_weight: 0.3
                            });
                        });
                    }
                }

                getAgentCurrentState(agentName) {
                    const baseState = this.memorySystem.getAgentState(agentName);
                    const interactionMetrics = this.memorySystem.getInteractionMetrics(agentName);
                    const relationshipLevel = this.memorySystem.getRelationshipLevel(agentName);
                    
                    const computedState = {
                        ...baseState,
                        computed: {
                            mood_description: MOOD_TYPES[baseState.mood]?.description || 'Unknown mood',
                            relationship_description: RELATIONSHIP_LEVELS[relationshipLevel]?.description || 'Unknown relationship',
                            interaction_frequency: this.calculateInteractionFrequency(interactionMetrics),
                            adaptation_level: this.calculateAdaptationLevel(baseState),
                            memory_richness: this.calculateMemoryRichness(agentName),
                            response_modifiers: this.calculateResponseModifiers(baseState, relationshipLevel)
                        }
                    };

                    return computedState;
                }

                updateAgentMood(agentName, interactionContext) {
                    try {
                        const currentState = this.memorySystem.getAgentState(agentName);
                        const behaviorPattern = this.behaviorPatterns.get(agentName);
                        
                        if (!behaviorPattern) return false;

                        let newMood = currentState.mood;
                        
                        if (interactionContext?.type === 'complex_problem') {
                            newMood = 'analytical';
                        } else if (interactionContext?.type === 'creative_request') {
                            newMood = 'creative';
                        } else if (interactionContext?.type === 'urgent_task') {
                            newMood = 'efficient';
                        } else if (interactionContext?.type === 'detailed_analysis') {
                            newMood = 'thorough';
                        } else if (interactionContext?.sentiment === 'positive') {
                            newMood = 'enthusiastic';
                        } else if (interactionContext?.risk_level === 'high') {
                            newMood = 'cautious';
                        }

                        this.memorySystem.updateAgentState(agentName, { 
                            mood: newMood,
                            energy_level: this.calculateEnergyLevel(currentState, interactionContext)
                        });

                        return true;
                    } catch (error) {
                        console.error('Error updating agent mood:', error);
                        return false;
                    }
                }

                calculateEnergyLevel(currentState, interactionContext) {
                    let energyLevel = currentState.energy_level || 5;
                    
                    if (interactionContext?.sentiment === 'positive') {
                        energyLevel = Math.min(10, energyLevel + 0.5);
                    }
                    
                    if (interactionContext?.complexity === 'high') {
                        energyLevel = Math.max(1, energyLevel - 0.3);
                    }
                    
                    const lastInteraction = new Date(currentState.last_interaction || Date.now());
                    const timeDiff = (Date.now() - lastInteraction.getTime()) / (1000 * 60 * 60);
                    
                    if (timeDiff > 1) {
                        energyLevel = Math.min(10, energyLevel + (timeDiff * 0.1));
                    }
                    
                    return Math.round(energyLevel * 10) / 10;
                }

                updateRelationshipLevel(agentName, interactionQuality) {
                    try {
                        const currentLevel = this.memorySystem.getRelationshipLevel(agentName);
                        const metrics = this.memorySystem.getInteractionMetrics(agentName);
                        
                        let newLevel = currentLevel;
                        const interactionCount = metrics?.total_interactions || 0;
                        
                        if (interactionQuality === 'positive' && interactionCount > 5) {
                            if (currentLevel === 'stranger') newLevel = 'acquaintance';
                            else if (currentLevel === 'acquaintance' && interactionCount > 15) newLevel = 'neutral';
                            else if (currentLevel === 'neutral' && interactionCount > 30) newLevel = 'familiar';
                            else if (currentLevel === 'familiar' && interactionCount > 50) newLevel = 'trusted';
                        } else if (interactionQuality === 'negative') {
                            if (currentLevel === 'trusted') newLevel = 'familiar';
                            else if (currentLevel === 'familiar') newLevel = 'neutral';
                            else if (currentLevel === 'neutral') newLevel = 'acquaintance';
                        }

                        if (newLevel !== currentLevel) {
                            this.memorySystem.updateRelationshipLevel(agentName, newLevel);
                            return { changed: true, from: currentLevel, to: newLevel };
                        }

                        return { changed: false, level: currentLevel };
                    } catch (error) {
                        console.error('Error updating relationship level:', error);
                        return { changed: false, level: currentLevel };
                    }
                }

                learnUserPreferences(agentName, interactionData) {
                    try {
                        const currentState = this.memorySystem.getAgentState(agentName);
                        const learnedPrefs = currentState.learned_preferences || {};
                        
                        if (interactionData.communication_style) {
                            learnedPrefs.communication_style = interactionData.communication_style;
                        }
                        if (interactionData.detail_preference) {
                            learnedPrefs.detail_level = interactionData.detail_preference;
                        }
                        if (interactionData.response_format) {
                            learnedPrefs.format_preference = interactionData.response_format;
                        }
                        
                        this.memorySystem.updateAgentState(agentName, { 
                            learned_preferences: learnedPrefs 
                        });

                        return true;
                    } catch (error) {
                        console.error('Error learning user preferences:', error);
                        return false;
                    }
                }

                generateContextualMemory(agentName, messageContent) {
                    try {
                        const conversationHistory = this.memorySystem.getConversationHistory(agentName, 10);
                        const agentState = this.getAgentCurrentState(agentName);
                        
                        const contextualMemory = {
                            recent_topics: this.extractTopics(conversationHistory),
                            interaction_patterns: this.analyzeInteractionPatterns(conversationHistory),
                            current_mood: agentState.mood,
                            relationship_context: agentState.computed.relationship_description,
                            learned_preferences: agentState.learned_preferences || {},
                            energy_level: agentState.energy_level
                        };

                        return contextualMemory;
                    } catch (error) {
                        console.error('Error generating contextual memory:', error);
                        return {};
                    }
                }

                extractTopics(conversationHistory) {
                    const topics = new Set();
                    
                    conversationHistory.forEach(entry => {
                        const message = entry.message.toLowerCase();
                        
                        const keywords = [
                            'react', 'javascript', 'typescript', 'python', 'nodejs',
                            'database', 'api', 'frontend', 'backend', 'deployment',
                            'security', 'performance', 'testing', 'architecture',
                            'design', 'optimization', 'documentation'
                        ];
                        
                        keywords.forEach(keyword => {
                            if (message.includes(keyword)) {
                                topics.add(keyword);
                            }
                        });
                    });

                    return Array.from(topics);
                }

                analyzeInteractionPatterns(conversationHistory) {
                    const patterns = {
                        average_message_length: 0,
                        question_frequency: 0,
                        technical_depth: 'medium',
                        communication_style: 'balanced'
                    };

                    if (conversationHistory.length === 0) return patterns;

                    const totalLength = conversationHistory.reduce((sum, entry) => 
                        sum + (entry.message?.length || 0), 0
                    );
                    patterns.average_message_length = Math.round(totalLength / conversationHistory.length);

                    const questionCount = conversationHistory.filter(entry => 
                        entry.message?.includes('?') || entry.message?.includes('how') || 
                        entry.message?.includes('what') || entry.message?.includes('why')
                    ).length;
                    patterns.question_frequency = questionCount / conversationHistory.length;

                    const technicalKeywords = ['implementation', 'algorithm', 'architecture', 'optimization', 'configuration'];
                    const technicalCount = conversationHistory.filter(entry => 
                        technicalKeywords.some(keyword => entry.message?.toLowerCase().includes(keyword))
                    ).length;
                    
                    if (technicalCount / conversationHistory.length > 0.3) {
                        patterns.technical_depth = 'high';
                    } else if (technicalCount / conversationHistory.length < 0.1) {
                        patterns.technical_depth = 'low';
                    }

                    return patterns;
                }

                calculateInteractionFrequency(metrics) {
                    if (!metrics || !metrics.total_interactions) return 'new';
                    
                    const interactions = metrics.total_interactions;
                    if (interactions < 5) return 'new';
                    if (interactions < 20) return 'occasional';
                    if (interactions < 50) return 'regular';
                    return 'frequent';
                }

                calculateAdaptationLevel(state) {
                    const hasLearnedPrefs = Object.keys(state.learned_preferences || {}).length > 0;
                    const hasContextMemory = (state.context_memory || []).length > 0;
                    const interactionCount = state.interaction_count || 0;
                    
                    if (interactionCount > 30 && hasLearnedPrefs && hasContextMemory) return 'high';
                    if (interactionCount > 10 && (hasLearnedPrefs || hasContextMemory)) return 'medium';
                    if (interactionCount > 0) return 'low';
                    return 'none';
                }

                calculateMemoryRichness(agentName) {
                    const conversationCount = this.memorySystem.getConversationHistory(agentName).length;
                    const state = this.memorySystem.getAgentState(agentName);
                    const contextMemoryCount = (state.context_memory || []).length;
                    
                    const richness = (conversationCount * 0.1) + (contextMemoryCount * 0.5);
                    
                    if (richness > 10) return 'rich';
                    if (richness > 5) return 'moderate';
                    if (richness > 1) return 'basic';
                    return 'minimal';
                }

                calculateResponseModifiers(state, relationshipLevel) {
                    const moodModifiers = MOOD_TYPES[state.mood]?.response_modifiers || {};
                    const relationshipData = RELATIONSHIP_LEVELS[relationshipLevel] || {};
                    
                    return {
                        ...moodModifiers,
                        personalization: relationshipData.personalization || 0.5,
                        trust_level: relationshipData.trust_level || 0.5,
                        energy_factor: (state.energy_level || 5) / 10
                    };
                }

                getAgentSummary(agentName) {
                    const state = this.getAgentCurrentState(agentName);
                    const metrics = this.memorySystem.getInteractionMetrics(agentName);
                    
                    return {
                        name: agentName,
                        mood: state.mood,
                        mood_description: state.computed.mood_description,
                        energy_level: state.energy_level,
                        relationship_level: this.memorySystem.getRelationshipLevel(agentName),
                        relationship_description: state.computed.relationship_description,
                        interaction_count: metrics?.total_interactions || 0,
                        last_interaction: metrics?.last_interaction || null,
                        memory_richness: state.computed.memory_richness,
                        adaptation_level: state.computed.adaptation_level
                    };
                }

                resetAgentToDefault(agentName) {
                    try {
                        this.memorySystem.clearConversationHistory(agentName);
                        this.memorySystem.resetAgentState(agentName);
                        this.memorySystem.updateRelationshipLevel(agentName, 'neutral');
                        
                        const metrics = this.memorySystem.getData('cua_interaction_metrics') || {};
                        delete metrics[agentName];
                        this.memorySystem.setData('cua_interaction_metrics', metrics);
                        
                        return true;
                    } catch (error) {
                        console.error('Error resetting agent to default:', error);
                        return false;
                    }
                }
            }
            window.CUA_AgentState = new AgentStateManager();
            console.log('Agent State System initialized successfully');
        })();
    </script>
    <script>
        // orchestration.js content will be placed here
        // Make orchestrationState and liveCustomInstructions global for shared access
        window.orchestrationState = {
            selectedAgent: null,
            customInstructions: {
                system: '',
                behavior: '',
                context: ''
            },
            chatHistory: [],
            sessionId: null,
            userId: null,
            isLoggingEnabled: true,
            memoryEnabled: true,
            currentAgentState: null,
            controlPanelOpen: false,
            chainSteps: [],
            activeTasks: [],
            apiConfiguration: {
                selectedService: '',
                apiKey: '',
                webhookUrl: '',
                webhookEvents: []
            },
            randomnessLevel: 0.7
        };

        window.liveCustomInstructions = { 
            system: '', 
            ai: '', 
            user: '',
            agent_personality: '',
            agent_specialization: '',
            response_pattern: ''
        };

        (function() {
            'use strict';

            console.log('Orchestration Hub initializing...');

            function initializeControlPanel() {
                const toggleBtn = document.getElementById('control-panel-toggle');
                // Changed from 'control-panel-toggle' to 'control-panel-close-btn'
                const closeBtn = document.getElementById('control-panel-close-btn');
                const body = document.body;

                function toggleControlPanel() {
                    window.orchestrationState.controlPanelOpen = !window.orchestrationState.controlPanelOpen;
                    
                    if (window.orchestrationState.controlPanelOpen) {
                        body.classList.add('control-panel-open');
                        if (toggleBtn) toggleBtn.classList.add('active');
                        logMessage('Control panel opened', 'system');
                    } else {
                        body.classList.remove('control-panel-open');
                        if (toggleBtn) toggleBtn.classList.remove('active');
                        logMessage('Control panel closed', 'system');
                    }
                }

                if (toggleBtn) {
                    toggleBtn.addEventListener('click', toggleControlPanel);
                }

                if (closeBtn) {
                    closeBtn.addEventListener('click', toggleControlPanel);
                }

                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && window.orchestrationState.controlPanelOpen) {
                        toggleControlPanel();
                    }
                });
            }

            function initializeChainSystem() {
                const addToChainBtn = document.getElementById('add-to-chain');
                const chainSystemInput = document.getElementById('chain-system');
                const chainAiInput = document.getElementById('chain-ai');
                const chainUserInput = document.getElementById('chain-user');
                const chainList = document.getElementById('chain-list');
                const applyInstructionsBtn = document.getElementById('apply-instructions');

                function addChainStep() {
                    const systemText = chainSystemInput?.value?.trim() || '';
                    const aiText = chainAiInput?.value?.trim() || '';
                    const userText = chainUserInput?.value?.trim() || '';

                    if (!systemText && !aiText && !userText) {
                        alert('Please enter at least one instruction before adding to chain.'); // Using alert for simplicity, replace with custom modal
                        return;
                    }

                    const chainStep = {
                        id: Date.now(),
                        system: systemText,
                        ai: aiText,
                        user: userText,
                        timestamp: new Date().toISOString()
                    };

                    window.orchestrationState.chainSteps.push(chainStep);
                    renderChainSteps();
                    
                    if (chainSystemInput) chainSystemInput.value = '';
                    if (chainAiInput) chainAiInput.value = '';
                    if (chainUserInput) chainUserInput.value = '';

                    logMessage(`Added chain step ${window.orchestrationState.chainSteps.length}`, 'system');
                }

                function renderChainSteps() {
                    if (!chainList) return;

                    if (window.orchestrationState.chainSteps.length === 0) {
                        chainList.innerHTML = `
                            <div class="empty-state text-center text-muted py-3">
                                <i class="display-6"></i>
                                <p>No chain steps added yet</p>
                            </div>
                        `;
                        return;
                    }

                    const stepsHtml = window.orchestrationState.chainSteps.map((step, index) => `
                        <div class="chain-step" data-step-id="${step.id}">
                            <div class="chain-step-header">Step ${index + 1}</div>
                            <div class="chain-step-content">
                                ${step.system ? `<div><strong>SYSTEM:</strong> ${step.system}</div>` : ''}
                                ${step.ai ? `<div><strong>AI:</strong> ${step.ai}</div>` : ''}
                                ${step.user ? `<div><strong>USER:</strong> ${step.user}</div>` : ''}
                            </div>
                            <button class="chain-step-remove" onclick="window.removeChainStep(${step.id})" title="Remove step"></button>
                        </div>
                    `).join('');

                    chainList.innerHTML = stepsHtml;
                }

                function applyInstructions() {
                    if (window.orchestrationState.chainSteps.length === 0) {
                        alert('No chain steps to apply. Please add at least one step.'); // Using alert for simplicity
                        return;
                    }

                    const combinedInstructions = window.orchestrationState.chainSteps.map((step, index) => {
                        let stepText = `Step ${index + 1}:\n`;
                        if (step.system) stepText += `SYSTEM: ${step.system}\n`;
                        if (step.ai) stepText += `AI: ${step.ai}\n`;
                        if (step.user) stepText += `USER: ${step.user}\n`;
                        return stepText;
                    }).join('\n');

                    window.liveCustomInstructions.system = combinedInstructions;
                    
                    logMessage('Chain instructions applied successfully', 'system');
                    alert('Chain instructions have been applied to the AI system.'); // Using alert for simplicity
                }

                window.removeChainStep = function(stepId) {
                    window.orchestrationState.chainSteps = window.orchestrationState.chainSteps.filter(step => step.id !== stepId);
                    renderChainSteps();
                    logMessage(`Removed chain step`, 'system');
                };

                if (addToChainBtn) {
                    addToChainBtn.addEventListener('click', addChainStep);
                }

                if (applyInstructionsBtn) {
                    applyInstructionsBtn.addEventListener('click', applyInstructions);
                }

                renderChainSteps();
            }

            function initializeTaskflowSystem() {
                const scheduleTaskBtn = document.getElementById('schedule-task');
                const taskNameInput = document.getElementById('task-name');
                const taskAgentSelect = document.getElementById('task-agent');
                const taskDetailsInput = document.getElementById('task-details');
                const taskList = document.getElementById('task-list');

                function scheduleTask() {
                    const taskName = taskNameInput?.value?.trim() || '';
                    const taskAgent = taskAgentSelect?.value || '';
                    const taskDetails = taskDetailsInput?.value?.trim() || '';

                    if (!taskName || !taskAgent || !taskDetails) {
                        alert('Please fill in all task fields before scheduling.'); // Using alert for simplicity
                        return;
                    }

                    const task = {
                        id: Date.now(),
                        name: taskName,
                        agent: taskAgent,
                        details: taskDetails,
                        status: 'pending',
                        createdAt: new Date().toISOString(),
                        scheduledAt: new Date(Date.now() + Math.random() * 60000).toISOString()
                    };

                    window.orchestrationState.activeTasks.push(task);
                    renderTaskList();

                    if (taskNameInput) taskNameInput.value = '';
                    if (taskAgentSelect) taskAgentSelect.value = '';
                    if (taskDetailsInput) taskDetailsInput.value = '';

                    logMessage(`Scheduled task: ${taskName}`, 'system');

                    setTimeout(() => updateTaskStatus(task.id, 'running'), 2000);
                    setTimeout(() => updateTaskStatus(task.id, 'completed'), 5000 + Math.random() * 10000);
                }

                function updateTaskStatus(taskId, newStatus) {
                    const task = window.orchestrationState.activeTasks.find(t => t.id === taskId);
                    if (task) {
                        task.status = newStatus;
                        renderTaskList();
                        logMessage(`Task ${task.name} status: ${newStatus}`, 'system');

                        triggerWebhook('task_status_change', { taskId, status: newStatus, taskName: task.name });
                    }
                }

                function renderTaskList() {
                    if (!taskList) return;

                    if (window.orchestrationState.activeTasks.length === 0) {
                        taskList.innerHTML = `
                            <div class="empty-state text-center text-muted py-3">
                                <i class="display-6"></i>
                                <p>No active tasks</p>
                            </div>
                        `;
                        return;
                    }

                    const tasksHtml = window.orchestrationState.activeTasks.map(task => `
                        <div class="task-item" data-task-id="${task.id}">
                            <div class="task-header">
                                <h6 class="task-name">${task.name}</h6>
                                <span class="task-status ${task.status}">${task.status.toUpperCase()}</span>
                            </div>
                            <div class="task-agent">Agent: ${task.agent}</div>
                            <div class="task-details">${task.details}</div>
                            <div class="task-actions">
                                <button class="btn btn-outline-primary btn-sm" onclick="window.monitorTask(${task.id})">Monitor</button>
                                <button class="btn btn-outline-danger btn-sm" onclick="window.cancelTask(${task.id})" ${task.status === 'completed' ? 'disabled' : ''}>Cancel</button>
                            </div>
                        </div>
                    `).join('');

                    taskList.innerHTML = tasksHtml;
                }

                window.monitorTask = function(taskId) {
                    const task = window.orchestrationState.activeTasks.find(t => t.id === taskId);
                    if (task) {
                        alert(`Task Monitor:\nName: ${task.name}\nStatus: ${task.status}\nAgent: ${task.agent}\nCreated: ${new Date(task.createdAt).toLocaleString()}`); // Using alert for simplicity
                    }
                };

                window.cancelTask = function(taskId) {
                    const taskIndex = window.orchestrationState.activeTasks.findIndex(t => t.id === taskId);
                    if (taskIndex !== -1) {
                        const task = window.orchestrationState.activeTasks[taskIndex];
                        window.orchestrationState.activeTasks.splice(taskIndex, 1);
                        renderTaskList();
                        logMessage(`Cancelled task: ${task.name}`, 'system');
                    }
                };

                if (scheduleTaskBtn) {
                    scheduleTaskBtn.addEventListener('click', scheduleTask);
                }

                renderTaskList();
            }

            function initializeApiSystem() {
                const saveApiKeyBtn = document.getElementById('save-api-key');
                const apiServiceSelect = document.getElementById('api-service');
                const apiKeyInput = document.getElementById('api-key');
                const setWebhookBtn = document.getElementById('set-webhook');
                const webhookUrlInput = document.getElementById('webhook-url');
                const generateSignupBtn = document.getElementById('generate-signup-link');
                const signupLinkInput = document.getElementById('signup-link');
                const copySignupBtn = document.getElementById('copy-signup-link');

                function saveApiKey() {
                    const service = apiServiceSelect?.value || '';
                    const apiKey = apiKeyInput?.value?.trim() || '';

                    if (!service || !apiKey) {
                        alert('Please select a service and enter an API key.'); // Using alert for simplicity
                        return;
                    }

                    window.orchestrationState.apiConfiguration.selectedService = service;
                    window.orchestrationState.apiConfiguration.apiKey = apiKey;

                    logMessage(`API key saved for ${service}`, 'system');
                    alert('API key saved successfully!'); // Using alert for simplicity

                    if (apiKeyInput) apiKeyInput.value = '';
                }

                function setWebhook() {
                    const webhookUrl = webhookUrlInput?.value?.trim() || '';
                    const events = [];

                    const eventCheckboxes = ['webhook-task-complete', 'webhook-agent-error', 'webhook-chain-complete'];
                    eventCheckboxes.forEach(id => {
                        const checkbox = document.getElementById(id);
                        if (checkbox?.checked) {
                            events.push(id.replace('webhook-', '').replace('-', '_'));
                        }
                    });

                    if (!webhookUrl) {
                        alert('Please enter a webhook URL.'); // Using alert for simplicity
                        return;
                    }

                    window.orchestrationState.apiConfiguration.webhookUrl = webhookUrl;
                    window.orchestrationState.apiConfiguration.webhookEvents = events;

                    logMessage(`Webhook configured: ${webhookUrl}`, 'system');
                    alert('Webhook configuration saved successfully!'); // Using alert for simplicity
                }

                function generateSignupLink() {
                    const randomId = Math.random().toString(36).substring(2, 15);
                    const signupLink = `https://orchestration-hub.app/signup?ref=${randomId}&api_key=${window.orchestrationState.apiConfiguration.apiKey?.substring(0, 8)}...`;
                    
                    if (signupLinkInput) {
                        signupLinkInput.value = signupLink;
                    }

                    if (copySignupBtn) {
                        copySignupBtn.disabled = false;
                    }

                    logMessage('Generated signup delegation link', 'system');
                }

                function copySignupLink() {
                    if (signupLinkInput?.value) {
                        navigator.clipboard.writeText(signupLinkInput.value).then(() => {
                            alert('Signup link copied to clipboard!'); // Using alert for simplicity
                        }).catch(() => {
                            alert('Failed to copy link. Please copy manually.'); // Using alert for simplicity
                        });
                    }
                }

                if (saveApiKeyBtn) {
                    saveApiKeyBtn.addEventListener('click', saveApiKey);
                }

                if (setWebhookBtn) {
                    setWebhookBtn.addEventListener('click', setWebhook);
                }

                if (generateSignupBtn) {
                    generateSignupBtn.addEventListener('click', generateSignupLink);
                }

                if (copySignupBtn) {
                    copySignupBtn.addEventListener('click', copySignupLink);
                }
            }

            function triggerWebhook(event, data) {
                if (!window.orchestrationState.apiConfiguration.webhookUrl || 
                    !window.orchestrationState.apiConfiguration.webhookEvents.includes(event)) {
                    return;
                }

                const payload = {
                    event: event,
                    timestamp: new Date().toISOString(),
                    data: data
                };

                logMessage(`Webhook triggered: ${event}`, 'system');
                console.log('Webhook payload:', payload);
            }

            function initializeRandomnessControl() {
                const randomnessSlider = document.getElementById('randomness-slider');
                const randomnessValue = document.getElementById('randomness-value');

                function updateRandomness() {
                    if (randomnessSlider && randomnessValue) {
                        const value = parseFloat(randomnessSlider.value);
                        window.orchestrationState.randomnessLevel = value;
                        randomnessValue.textContent = value.toFixed(1);
                        
                        logMessage(`Randomness level set to ${value}`, 'system');
                    }
                }

                if (randomnessSlider) {
                    randomnessSlider.addEventListener('input', updateRandomness);
                    updateRandomness();
                }
            }

            function initializeControlAgentManagement() {
                const controlAgentSelect = document.getElementById('control-agent-select');
                const resetAgentBtn = document.getElementById('reset-agent-state');
                const loadContextBtn = document.getElementById('load-agent-context');
                const exportConfigBtn = document.getElementById('export-agent-config');

                function syncAgentData() {
                    const mainAgentSelect = document.getElementById('agent-select');
                    if (mainAgentSelect && controlAgentSelect) {
                        controlAgentSelect.innerHTML = mainAgentSelect.innerHTML;
                        controlAgentSelect.value = mainAgentSelect.value;
                    }
                }

                function resetAgentState() {
                    if (confirm('Are you sure you want to reset the agent state? This will clear all memory and context.')) { // Using confirm for simplicity
                        const selectedAgentName = controlAgentSelect?.options[controlAgentSelect.selectedIndex]?.textContent;
                        if (selectedAgentName && window.CUA_AgentState) {
                            window.CUA_AgentState.resetAgentToDefault(selectedAgentName);
                            window.orchestrationState.currentAgentState = null;
                            window.orchestrationState.chatHistory = []; // Also clear chat for the agent
                            logMessage(`Agent ${selectedAgentName} state reset`, 'system');
                            alert('Agent state has been reset successfully.'); // Using alert for simplicity
                        } else {
                            alert('Please select an agent to reset.'); // Using alert for simplicity
                        }
                    }
                }

                function loadAgentContext() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    input.onchange = function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                try {
                                    const context = JSON.parse(e.target.result);
                                    window.orchestrationState.currentAgentState = context;
                                    logMessage('Agent context loaded from file', 'system');
                                    alert('Agent context loaded successfully!'); // Using alert for simplicity
                                } catch (error) {
                                    alert('Error loading context file: ' + error.message); // Using alert for simplicity
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    input.click();
                }

                function exportAgentConfig() {
                    const config = {
                        agent: window.orchestrationState.selectedAgent,
                        instructions: window.liveCustomInstructions,
                        chainSteps: window.orchestrationState.chainSteps,
                        randomnessLevel: window.orchestrationState.randomnessLevel,
                        timestamp: new Date().toISOString()
                    };

                    const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `agent-config-${Date.now()}.json`;
                    a.click();
                    URL.revokeObjectURL(url);

                    logMessage('Agent configuration exported', 'system');
                }

                if (resetAgentBtn) {
                    resetAgentBtn.addEventListener('click', resetAgentState);
                }

                if (loadContextBtn) {
                    loadContextBtn.addEventListener('click', loadAgentContext);
                }

                if (exportConfigBtn) {
                    exportConfigBtn.addEventListener('click', exportAgentConfig);
                }

                syncAgentData();
            }

            function initializeSystemControl() {
                const refreshLogBtn = document.getElementById('refresh-log');
                const clearControlLogBtn = document.getElementById('clear-control-log');
                const runControlOrchestrationBtn = document.getElementById('run-control-orchestration');
                const restartSystemBtn = document.getElementById('restart-system');
                const emergencyStopBtn = document.getElementById('emergency-stop');

                function refreshLog() {
                    logMessage('Log refreshed', 'system');
                }

                function clearControlLog() {
                    const logEntries = document.getElementById('control-log-entries');
                    if (logEntries && confirm('Are you sure you want to clear the log?')) { // Using confirm for simplicity
                        logEntries.innerHTML = `
                            <div class="log-entry log-system d-flex align-items-start mb-2">
                                <span class="badge bg-primary log-timestamp me-2 small">[System]</span>
                                <span class="log-message small text-muted">Log cleared</span>
                            </div>
                        `;
                        logMessage('Control log cleared', 'system');
                    }
                }

                function runControlOrchestration() {
                    if (window.orchestrationState.chainSteps.length === 0) {
                        alert('No chain steps configured. Please set up instructions first.'); // Using alert for simplicity
                        return;
                    }

                    logMessage('Starting orchestration with configured chain...', 'system');
                    
                    setTimeout(() => {
                        logMessage('Orchestration step 1/3: Initializing agents', 'system');
                    }, 1000);
                    
                    setTimeout(() => {
                        logMessage('Orchestration step 2/3: Processing chain instructions', 'system');
                    }, 2000);
                    
                    setTimeout(() => {
                        logMessage('Orchestration step 3/3: Finalizing workflow', 'system');
                    }, 3000);
                    
                    setTimeout(() => {
                        logMessage('Orchestration completed successfully', 'system');
                        triggerWebhook('orchestration_complete', { chainSteps: window.orchestrationState.chainSteps.length });
                    }, 4000);
                }

                function restartSystem() {
                    if (confirm('Are you sure you want to restart the system? This will reset all current sessions.')) { // Using confirm for simplicity
                        logMessage('System restart initiated...', 'system');
                        setTimeout(() => {
                            logMessage('System restarted successfully', 'system');
                        }, 2000);
                    }
                }

                function emergencyStop() {
                    if (confirm('EMERGENCY STOP: This will immediately halt all operations. Continue?')) { // Using confirm for simplicity
                        window.orchestrationState.activeTasks.forEach(task => {
                            if (task.status !== 'completed') {
                                task.status = 'stopped';
                            }
                        });
                        
                        logMessage('EMERGENCY STOP ACTIVATED - All operations halted', 'error');
                        alert('Emergency stop activated. All operations have been halted.'); // Using alert for simplicity
                    }
                }

                if (refreshLogBtn) {
                    refreshLogBtn.addEventListener('click', refreshLog);
                }

                if (clearControlLogBtn) {
                    clearControlLogBtn.addEventListener('click', clearControlLog);
                }

                if (runControlOrchestrationBtn) {
                    runControlOrchestrationBtn.addEventListener('click', runControlOrchestration);
                }

                if (restartSystemBtn) {
                    restartSystemBtn.addEventListener('click', restartSystem);
                }

                if (emergencyStopBtn) {
                    emergencyStopBtn.addEventListener('click', emergencyStop);
                }
            }

            function logMessage(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `<div class="log-entry log-${type} d-flex align-items-start mb-2">
                    <span class="badge bg-${type === 'error' ? 'danger' : 'primary'} log-timestamp me-2 small">[${timestamp}]</span>
                    <span class="log-message small text-muted">${message}</span>
                </div>`;

                const mainLogEntries = document.getElementById('log-entries');
                if (mainLogEntries) {
                    mainLogEntries.insertAdjacentHTML('beforeend', logEntry);
                    mainLogEntries.scrollTop = mainLogEntries.scrollHeight;
                }

                const controlLogEntries = document.getElementById('control-log-entries');
                if (controlLogEntries) {
                    controlLogEntries.insertAdjacentHTML('beforeend', logEntry);
                    controlLogEntries.scrollTop = controlLogEntries.scrollHeight;
                }

                console.log(`[${type.toUpperCase()}] ${message}`);
            }

            function initializeSession() {
                window.orchestrationState.sessionId = window.CUA_Utils.generateSessionId();
                window.orchestrationState.userId = window.CUA_Utils.generateUserId();

                const sessionDisplays = ['session-display', 'control-session-display'];
                const userDisplays = ['user-display', 'control-user-display'];

                sessionDisplays.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = window.orchestrationState.sessionId;
                    }
                });

                userDisplays.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = window.orchestrationState.userId;
                    }
                });

                logMessage('Session initialized', 'system');
            }

            function initializeChat() {
                const chatForm = document.getElementById('chat-form');
                const chatInput = document.getElementById('chat-input');
                const chatSendBtn = document.getElementById('chat-send-btn');
                const chatMessages = document.getElementById('chat-messages');

                function sendMessage(messageText) {
                    if (!messageText.trim()) return;

                    const userMessage = {
                        id: Date.now(),
                        sender: 'user',
                        content: messageText,
                        timestamp: new Date().toISOString()
                    };

                    addMessageToChat(userMessage);
                    window.orchestrationState.chatHistory.push(userMessage);

                    if (chatInput) chatInput.value = '';

                    setTimeout(() => {
                        const aiMessage = {
                            id: Date.now() + 1,
                            sender: 'ai',
                            content: generateSimulatedResponse(messageText),
                            timestamp: new Date().toISOString()
                        };

                        addMessageToChat(aiMessage);
                        window.orchestrationState.chatHistory.push(aiMessage);
                    }, 1000 + Math.random() * 2000);

                    logMessage(`User message: ${messageText.substring(0, 50)}...`, 'info');
                }

                function addMessageToChat(message) {
                    if (!chatMessages) return;

                    const messageHtml = `
                        <div class="chat-message chat-message-${message.sender} mb-3">
                            <div class="message-header">
                                <span class="message-sender">${message.sender === 'user' ? 'You' : 'AI Assistant'}</span>
                                <span class="message-timestamp">${new Date(message.timestamp).toLocaleTimeString()}</span>
                            </div>
                            <div class="message-content">
                                ${message.content}
                            </div>
                        </div>
                    `;

                    chatMessages.insertAdjacentHTML('beforeend', messageHtml);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                function generateSimulatedResponse(userMessage) {
                    const responses = [
                        "I understand your request. Based on the current chain configuration, I'll process this through the established workflow.",
                        "Thanks for your input. The orchestration system is analyzing your request using the configured parameters.",
                        "I'm processing your message through the active agent network. Please wait while I coordinate the response.",
                        "Your request has been received and is being processed through the P2P taskflow system.",
                        "Based on the current randomness level and chain instructions, here's my analysis of your request.",
                        "The middleware system is processing your input. I'll provide a comprehensive response based on the configured AI behavior settings."
                    ];

                    const baseResponse = responses[Math.floor(Math.random() * responses.length)];
                    
                    if (window.orchestrationState.chainSteps.length > 0) {
                        return `${baseResponse}\n\nNote: Currently operating with ${window.orchestrationState.chainSteps.length} configured chain step(s) and randomness level ${window.orchestrationState.randomnessLevel.toFixed(1)}.`;
                    }

                    return baseResponse;
                }

                if (chatForm) {
                    chatForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const message = chatInput?.value?.trim() || '';
                        if (message) {
                            sendMessage(message);
                        }
                    });
                }

                function updateChatAvailability() {
                    const hasAgent = window.orchestrationState.selectedAgent;
                    const hasChain = window.orchestrationState.chainSteps.length > 0;
                    const isAvailable = hasAgent || hasChain;

                    if (chatInput) chatInput.disabled = !isAvailable;
                    if (chatSendBtn) chatSendBtn.disabled = !isAvailable;

                    if (isAvailable) {
                        logMessage('Chat interface enabled', 'system');
                    } else {
                        logMessage('Chat interface disabled (select agent or configure chain to enable)', 'system');
                    }
                }
                updateChatAvailability();
                setInterval(updateChatAvailability, 2000); // Check every 2 seconds
            }

            function loadAgentsForOrchestrationPanel() {
                const agentSelectors = ['agent-select', 'control-agent-select'];
                // Use actual CUA_DATA.ai_family for agent list
                const actualAgents = window.CUA_DATA.ai_family || [];

                agentSelectors.forEach(selectorId => {
                    const selector = document.getElementById(selectorId);
                    if (selector) {
                        selector.innerHTML = '<option value="">Choose an agent...</option>';
                        actualAgents.forEach(agent => {
                            const option = document.createElement('option');
                            option.value = agent.name; // Use agent name as value
                            option.textContent = agent.name;
                            option.dataset.role = agent.role;
                            option.dataset.specialization = agent.specialization;
                            selector.appendChild(option);
                        });
                    }
                });
                logMessage(`Loaded ${actualAgents.length} AI agents for control panel`, 'system');
            }

            // Expose the main initialization function for the SPA router
            window.initializeOrchestrationHub = function() {
                console.log('Initializing Enhanced Orchestration Hub...');
                try {
                    initializeSession();
                    loadAgentsForOrchestrationPanel(); // Load agents for internal selectors
                    initializeControlPanel();
                    initializeChainSystem();
                    initializeTaskflowSystem();
                    initializeApiSystem();
                    initializeRandomnessControl();
                    initializeControlAgentManagement();
                    initializeSystemControl();
                    initializeChat(); // Call chat initialization specifically for orchestration hub
                    logMessage('Orchestration Hub fully initialized with control panel system', 'system');
                    console.log(' Orchestration Hub ready!');
                } catch (error) {
                    console.error(' Orchestration Hub Initialization error:', error);
                    logMessage(`Orchestration Hub Initialization error: ${error.message}`, 'error');
                }
            };
        })();
    </script>
    <script>
        // main.js content will be placed here, adapted for SPA
        window.CUA_App = window.CUA_App || {}; // Ensure CUA_App exists
        window.CUA_App.currentSession = window.CUA_App.currentSession || {
            agent: null,
            chatHistory: [],
            selectedCardElement: null,
            userId: null,
            sessionId: null
        };
        // liveCustomInstructions is now managed by orchestration.js (global)
        
        (function() {
            'use strict';

            console.log('CUA Engine script loading...');

            const dom = {};
            
            function initializeDOM() {
                try {
                    dom.navbar = document.querySelector('.navbar');
                    dom.userId = document.getElementById('user-id');
                    dom.sessionId = document.getElementById('session-id');
                    dom.agentGrid = document.getElementById('agent-grid');
                    dom.orchestrationGrid = document.getElementById('orchestration-grid');
                    dom.welcomePanel = document.getElementById('welcome-panel'); // Not directly used in this SPA structure
                    dom.detailPanel = document.getElementById('detail-panel');
                    dom.detailContent = document.getElementById('detail-content');
                    dom.orchestrationPanel = document.getElementById('orchestration-output-panel');
                    dom.orchestrationTitle = document.getElementById('orchestration-title');
                    dom.orchestrationSteps = document.getElementById('orchestration-steps');
                    dom.instructionsPanel = document.getElementById('custom-instructions-panel');
                    dom.instructionsTrigger = document.getElementById('custom-instructions-trigger'); // Not used directly in new layout
                    dom.closeInstructionsBtn = document.getElementById('close-instructions-btn');
                    dom.instructionsForm = document.getElementById('custom-instructions-form');
                    dom.errorModal = document.getElementById('error-modal');
                    dom.errorMessage = document.getElementById('error-message');
                    dom.closeModalBtn = document.getElementById('close-modal-btn');
                    
                    console.log('DOM elements initialized successfully');
                } catch (error) {
                    console.error('Error initializing DOM elements:', error);
                }
            }

            // Expose utility functions used by global context
            window.CUA_App.showError = showError;
            window.CUA_App.showSuccess = showSuccess;

            window.initMainPage = function() {
                try {
                    console.log('Starting CUA Engine Main Page initialization...');
                    
                    initializeDOM(); // Ensure DOM elements are available

                    if (!window.CUA_DATA || !window.CUA_Utils || !window.CUA_Memory || !window.CUA_AgentState) {
                        console.error('Required CUA global objects not available. Retrying main page init...');
                        setTimeout(window.initMainPage, 100);
                        return;
                    }

                    console.log('CUA Global dependencies loaded for main page.');

                    // Initialize session IDs display if not already by orchestration hub
                    if (!window.CUA_App.currentSession.userId) {
                        window.CUA_App.currentSession.userId = window.CUA_Utils.generateUserId();
                        if (dom.userId) dom.userId.textContent = window.CUA_App.currentSession.userId;
                    }
                    if (!window.CUA_App.currentSession.sessionId) {
                        window.CUA_App.currentSession.sessionId = window.CUA_Utils.generateSessionId();
                        if (dom.sessionId) dom.sessionId.textContent = window.CUA_App.currentSession.sessionId;
                    }

                    initializeNavigation(); // Navbar animation
                    initializeAgents(); // Populate agent grid
                    initializeOrchestrations(); // Populate orchestration grid
                    initializeCustomInstructions(); // Setup custom instructions panel
                    initializeModal(); // Setup error modal
                    initializeScrollEffects(); // Card fade-in effects
                    
                    console.log('CUA Engine Main Page initialized successfully');
                } catch (error) {
                    console.error('Critical error initializing CUA Engine Main Page:', error);
                    showError('Critical initialization error: ' + error.message);
                }
            };

            function initializeNavigation() {
                if (!dom.navbar) return;
                
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 50) {
                        dom.navbar.style.backgroundColor = 'rgba(31, 41, 55, 0.98)';
                    } else {
                        dom.navbar.style.backgroundColor = 'rgba(31, 41, 55, 0.95)';
                    }
                });
            }

            function initializeAgents() {
                if (!dom.agentGrid) {
                    console.error('Agent grid element not found');
                    return;
                }
                
                if (!window.CUA_DATA || !Array.isArray(window.CUA_DATA.ai_family)) {
                    console.error('ai_family data not available or not an array for agents');
                    return;
                }
                
                // Clear existing cards before adding new ones
                dom.agentGrid.innerHTML = '';

                window.CUA_DATA.ai_family.forEach((agent) => {
                    try {
                        const card = createAgentCard(agent);
                        dom.agentGrid.appendChild(card);
                    } catch (error) {
                        console.error(`Error creating agent card for ${agent.name}:`, error);
                    }
                });
            }

            function createAgentCard(agent) {
                if (!agent) {
                    console.error('Agent data is null or undefined');
                    return document.createElement('div');
                }
                
                const card = document.createElement('div');
                card.className = 'card agent-card fade-in';
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                
                const agentName = agent.name || 'Unknown Agent';
                const agentRole = agent.role || 'Unknown Role';
                const agentPhilosophy = agent.philosophy || 'No philosophy defined';
                const focusAreas = Array.isArray(agent.focus_areas) ? agent.focus_areas : [];
                
                card.setAttribute('aria-label', `Select ${agentName} - ${agentRole}`);
                
                try {
                    card.innerHTML = `
                        <div class="agent-avatar">
                            <div class="agent-initial">${agentName.charAt(0)}</div>
                        </div>
                        <h3 class="agent-name">${agentName}</h3>
                        <p class="agent-role">${agentRole}</p>
                        <p class="agent-philosophy">"${agentPhilosophy}"</p>
                        <div class="agent-focus">
                            ${focusAreas.slice(0, 2).map(area => 
                                `<span class="focus-tag">${area || 'Focus Area'}</span>`
                            ).join('')}
                        </div>
                    `;
                } catch (error) {
                    console.error('Error setting agent card innerHTML:', error);
                    card.innerHTML = `
                        <div class="agent-avatar">
                            <div class="agent-initial">${agentName.charAt(0)}</div>
                        </div>
                        <h3 class="agent-name">${agentName}</h3>
                        <p class="agent-role">${agentRole}</p>
                        <p class="agent-philosophy">Error loading agent details</p>
                    `;
                }
                
                card.addEventListener('click', () => selectAgent(agent, card));
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectAgent(agent, card);
                    }
                });
                
                return card;
            }

            function initializeOrchestrations() {
                if (!dom.orchestrationGrid) {
                    console.error('Orchestration grid element not found');
                    return;
                }
                
                if (!window.CUA_DATA || !Array.isArray(window.CUA_DATA.chained_bookmarks)) {
                    console.error('chained_bookmarks data not available or not an array');
                    return;
                }
                
                // Clear existing cards
                dom.orchestrationGrid.innerHTML = '';

                window.CUA_DATA.chained_bookmarks.forEach((orchestration) => {
                    try {
                        const card = createOrchestrationCard(orchestration);
                        dom.orchestrationGrid.appendChild(card);
                    } catch (error) {
                        console.error(`Error creating orchestration card for ${orchestration.name}:`, error);
                    }
                });

                // Add custom instructions card
                try {
                    console.log('Creating custom instructions card');
                    const customCard = createCustomInstructionsCard();
                    dom.orchestrationGrid.appendChild(customCard);
                } catch (error) {
                    console.error('Error creating custom instructions card:', error);
                }
            }

            function createOrchestrationCard(orchestration) {
                if (!orchestration) {
                    console.error('Orchestration data is null or undefined');
                    return document.createElement('div');
                }
                
                const card = document.createElement('div');
                card.className = 'card orchestration-card fade-in';
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                
                const orchestrationName = orchestration.name || 'Unknown Orchestration';
                const orchestrationDescription = orchestration.description || 'No description available';
                const orchestrationIcon = orchestration.icon || '';
                const associatedAgent = orchestration.associated_agent || 'Unknown Agent';
                const chainLength = Array.isArray(orchestration.chain) ? orchestration.chain.length : 0;
                
                card.setAttribute('aria-label', `Execute ${orchestrationName}`);
                
                try {
                    card.innerHTML = `
                        <div class="orchestration-icon">${orchestrationIcon}</div>
                        <h3 class="orchestration-name">${orchestrationName}</h3>
                        <p class="orchestration-description">${orchestrationDescription}</p>
                        <div class="orchestration-agent">
                            <span class="agent-badge">Lead: ${associatedAgent}</span>
                        </div>
                        <div class="orchestration-steps-count">
                            ${chainLength} steps
                        </div>
                    `;
                } catch (error) {
                    console.error('Error setting orchestration card innerHTML:', error);
                    card.innerHTML = `
                        <div class="orchestration-icon"></div>
                        <h3 class="orchestration-name">${orchestrationName}</h3>
                        <p class="orchestration-description">Error loading orchestration details</p>
                        <div class="orchestration-agent">
                            <span class="agent-badge">Lead: ${associatedAgent}</span>
                        </div>
                    `;
                }
                
                card.addEventListener('click', () => {
                    executeOrchestration(orchestration, "User-initiated orchestration execution");
                });
                
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        executeOrchestration(orchestration, "User-initiated orchestration execution");
                    }
                });
                
                return card;
            }

            function createCustomInstructionsCard() {
                const card = document.createElement('div');
                card.className = 'card orchestration-card fade-in';
                card.style.borderColor = '#10b981';
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                card.setAttribute('aria-label', 'Create custom instructions');
                
                card.innerHTML = `
                    <div class="orchestration-icon"></div>
                    <h3 class="orchestration-name">Custom Instructions</h3>
                    <p class="orchestration-description">Define SYSTEM, AI, and USER personas for this session.</p>
                    <div class="orchestration-agent">
                        <span class="agent-badge">Customize AI Behavior</span>
                    </div>
                `;
                
                card.addEventListener('click', toggleInstructionsPanel);
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleInstructionsPanel();
                    }
                });
                
                return card;
            }

            function selectAgent(agent, cardElement) {
                try {
                    clearSelection();
                    
                    window.CUA_App.currentSession.agent = agent;
                    // !!! IMPORTANT FIX: Synchronize selected agent with orchestrationState
                    window.orchestrationState.selectedAgent = agent;

                    window.CUA_App.currentSession.selectedCardElement = cardElement;
                    window.CUA_App.currentSession.chatHistory = [];
                    
                    cardElement.classList.add('card-selected');
                    
                    // Show detail panel and hide others
                    document.getElementById('home-page').classList.add('hidden');
                    document.getElementById('services-page').classList.add('hidden');
                    document.getElementById('docs-page').classList.add('hidden');
                    document.getElementById('contact-page').classList.add('hidden');
                    document.getElementById('orchestration-hub-page').classList.add('hidden');
                    
                    if (dom.detailPanel) dom.detailPanel.classList.remove('hidden');
                    
                    showAgentDetails(agent);
                    
                } catch (error) {
                    console.error('Error selecting agent:', error);
                }
            }

            function showAgentDetails(agent) {
                if (!dom.detailContent) return;
                
                const agentName = agent.name || 'Unknown Agent';
                const agentRole = agent.role || 'Unknown Role';
                const agentPhilosophy = agent.philosophy || 'No philosophy defined';
                const agentDescription = agent.description || 'Specialized AI agent focused on delivering high-quality development solutions.';
                const focusAreas = Array.isArray(agent.focus_areas) ? agent.focus_areas : [];
                const packagingInterrelation = Array.isArray(agent.packaging_interrelation) ? agent.packaging_interrelation : [];
                
                try {
                    dom.detailContent.innerHTML = `
                        <div class="agent-detail-header">
                            <div class="agent-detail-avatar">
                                <div class="agent-detail-initial">${agentName.charAt(0)}</div>
                            </div>
                            <div class="agent-detail-info">
                                <h2 class="agent-detail-name">${agentName}</h2>
                                <p class="agent-detail-role">${agentRole}</p>
                                <p class="agent-detail-philosophy">"${agentPhilosophy}"</p>
                            </div>
                        </div>
                        
                        <div class="agent-detail-content">
                            <div class="agent-detail-section">
                                <h4 class="detail-section-title">Description</h4>
                                <p class="detail-section-text">${agentDescription}</p>
                            </div>
                            
                            <div class="agent-detail-section">
                                <h4 class="detail-section-title">Primary Focus Areas</h4>
                                <div class="focus-areas">
                                    ${focusAreas.map(area => 
                                        `<span class="focus-area-tag">${area || 'Focus Area'}</span>`
                                    ).join('')}
                                </div>
                            </div>
                            
                            <div class="agent-detail-section">
                                <h4 class="detail-section-title">Packaging & Build Interrelation</h4>
                                <div class="packaging-list">
                                    ${packagingInterrelation.map(pkg => `
                                        <div class="packaging-item">
                                            <h5 class="packaging-type">${pkg?.type || 'Unknown Type'}</h5>
                                            <p class="packaging-description">${pkg?.description || 'No description available'}</p>
                                            <span class="packaging-tool">Tool: ${pkg?.utility_tool || 'Unknown Tool'}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="agent-actions">
                                <button id="start-conversation-btn" class="btn btn-primary">
                                     Start Conversation with ${agentName}
                                </button>
                            </div>
                            
                            <div id="chat-container" class="chat-container hidden">
                                <div id="chat-log" class="chat-log"></div>
                                <form id="chat-form" class="chat-form">
                                    <input type="text" id="chat-input" class="chat-input" 
                                           placeholder="Ask a question or use /execute..." required>
                                    <button type="submit" id="send-btn" class="btn btn-primary">Send</button>
                                </form>
                            </div>
                        </div>
                    `;
                    
                    const startBtn = document.getElementById('start-conversation-btn');
                    const chatForm = document.getElementById('chat-form');
                    
                    if (startBtn) {
                        startBtn.addEventListener('click', () => startConversation(agent));
                    }
                    
                    if (chatForm) {
                        chatForm.addEventListener('submit', handleChatSubmit);
                    }
                } catch (error) {
                    console.error('Error showing agent details:', error);
                    dom.detailContent.innerHTML = `
                        <div class="agent-detail-header">
                            <div class="agent-detail-avatar">
                                <div class="agent-detail-initial">${agentName.charAt(0)}</div>
                            </div>
                            <div class="agent-detail-info">
                                <h2 class="agent-detail-name">${agentName}</h2>
                                <p class="agent-detail-role">${agentRole}</p>
                                <p class="agent-detail-philosophy">"${agentPhilosophy}"</p>
                            </div>
                        </div>
                        <div class="agent-detail-content">
                            <p>Error loading full agent details. Please try again.</p>
                        </div>
                    `;
                }
            }

            async function executeOrchestration(orchestration, initialInput) {
                try {
                    if (!orchestration) {
                        console.error('Orchestration data is null or undefined');
                        return;
                    }

                    clearSelection();
                    
                    const orchestrationName = orchestration.name || 'Unknown Orchestration';
                    const orchestrationChain = Array.isArray(orchestration.chain) ? orchestration.chain : [];
                    
                    // Hide other sections and show orchestration panel
                    document.getElementById('home-page').classList.add('hidden');
                    document.getElementById('services-page').classList.add('hidden');
                    document.getElementById('docs-page').classList.add('hidden');
                    document.getElementById('contact-page').classList.add('hidden');
                    document.getElementById('orchestration-hub-page').classList.add('hidden');

                    if (dom.orchestrationPanel) dom.orchestrationPanel.classList.remove('hidden');
                    if (dom.detailPanel) dom.detailPanel.classList.add('hidden'); // Hide detail panel if visible
                    
                    if (dom.orchestrationTitle) {
                        dom.orchestrationTitle.textContent = `Executing: ${orchestrationName}`;
                    }
                    
                    if (dom.orchestrationSteps) {
                        dom.orchestrationSteps.innerHTML = '';
                    }

                    let previousOutput = initialInput || 'Initial input';

                    for (let i = 0; i < orchestrationChain.length; i++) {
                        const step = orchestrationChain[i];
                        
                        if (!step || !step.tool) {
                            console.warn(`Invalid step at index ${i}:`, step);
                            continue;
                        }
                        
                        const tool = window.CUA_Utils?.getToolByName?.(step.tool);
                        
                        if (!tool) {
                            console.warn(`Tool not found: ${step.tool}`);
                            continue;
                        }
                        
                        const stepElement = createOrchestrationStep(step, tool, i);
                        if (dom.orchestrationSteps) {
                            dom.orchestrationSteps.appendChild(stepElement);
                        }
                        
                        await simulateProcessing(1500);
                        
                        const outputId = `output_${tool.name || 'unknown'}_${i}.json`;
                        updateOrchestrationStep(stepElement, outputId, previousOutput);
                        previousOutput = outputId;
                    }
                    
                } catch (error) {
                    console.error('Error executing orchestration:', error);
                    if (error.message.includes('Critical') || error.message.includes('cannot read')) {
                        showError('Critical error in orchestration execution');
                    }
                }
            }

            function createOrchestrationStep(step, tool, index) {
                const stepElement = document.createElement('div');
                stepElement.className = 'orchestration-step fade-in';
                
                const toolName = tool?.name || 'Unknown Tool';
                const primaryAgent = tool?.primary_agent || 'Unknown Agent';
                const stepNumber = (index || 0) + 1;
                
                try {
                    stepElement.innerHTML = `
                        <div class="step-header">
                            <span class="step-number">${stepNumber}</span>
                            <div class="step-info">
                                <h4 class="step-tool-name">${toolName}</h4>
                                <p class="step-agent">Agent: ${primaryAgent}</p>
                            </div>
                            <div class="step-loader">
                                <div class="loader"></div>
                            </div>
                        </div>
                        <div class="step-details hidden">
                            <div class="step-input">
                                <strong>Input:</strong> <code class="step-input-text">Processing...</code>
                            </div>
                            <div class="step-output">
                                <strong>Output:</strong> <code class="step-output-text" id="output-${index || 0}">Generating...</code>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error('Error creating orchestration step:', error);
                    stepElement.innerHTML = `
                        <div class="step-header">
                            <span class="step-number">${stepNumber}</span>
                            <div class="step-info">
                                <h4 class="step-tool-name">Error loading step</h4>
                                <p class="step-agent">Please try again</p>
                            </div>
                        </div>
                    `;
                }
                
                return stepElement;
            }

            function updateOrchestrationStep(stepElement, outputId, inputText) {
                const loader = stepElement.querySelector('.step-loader');
                const details = stepElement.querySelector('.step-details');
                const inputElement = stepElement.querySelector('.step-input-text');
                const outputElement = stepElement.querySelector('.step-output-text');
                
                if (loader) loader.classList.add('hidden');
                if (details) details.classList.remove('hidden');
                if (inputElement) inputElement.textContent = inputText;
                if (outputElement) outputElement.textContent = outputId;
            }

            function initializeCustomInstructions() {
                // The trigger element for the panel is now handled by the orchestration hub's control panel toggle
                if (dom.closeInstructionsBtn) {
                    dom.closeInstructionsBtn.addEventListener('click', toggleInstructionsPanel);
                }
                
                if (dom.instructionsForm) {
                    dom.instructionsForm.addEventListener('submit', handleInstructionsSubmit);
                }
            }

            function toggleInstructionsPanel() {
                if (dom.instructionsPanel) {
                    dom.instructionsPanel.classList.toggle('panel-open');
                }
            }

            function handleInstructionsSubmit(e) {
                e.preventDefault();
                
                try {
                    const formData = new FormData(e.target);
                    
                    window.liveCustomInstructions.system = formData.get('system') || '';
                    window.liveCustomInstructions.ai = formData.get('ai') || '';
                    window.liveCustomInstructions.user = formData.get('user') || '';
                    
                    console.log('Custom Instructions Set:', window.liveCustomInstructions);
                    
                    showSuccess('Custom Instructions are now live for this session!');
                    
                    toggleInstructionsPanel();
                    
                } catch (error) {
                    console.error('Error setting custom instructions:', error);
                }
            }

            function startConversation(agent) {
                const startBtn = document.getElementById('start-conversation-btn');
                const chatContainer = document.getElementById('chat-container');
                
                if (startBtn) {
                    startBtn.innerHTML = '<div class="loader"></div> Starting conversation...';
                    startBtn.disabled = true;
                }
                
                setTimeout(() => {
                    if (chatContainer) {
                        chatContainer.classList.remove('hidden');
                    }
                    
                    if (startBtn && startBtn.parentElement) {
                        startBtn.parentElement.classList.add('hidden');
                    }
                    
                    addChatMessage('ai', `Hello! I'm ${agent.name}, ${agent.role}. ${agent.philosophy} How can I help you with your development needs today?`);
                    
                }, 2000);
            }

            function handleChatSubmit(e) {
                e.preventDefault();
                
                const chatInput = document.getElementById('chat-input');
                if (!chatInput) return;
                
                const message = chatInput.value.trim();
                if (!message) return;
                
                addChatMessage('user', message);
                
                chatInput.value = '';
                
                setTimeout(() => {
                    const response = generateAIResponse(message);
                    addChatMessage('ai', response);
                }, 1000);
            }

            function addChatMessage(type, message) {
                const chatLog = document.getElementById('chat-log');
                if (!chatLog) return;
                
                const messageElement = document.createElement('div');
                messageElement.className = `chat-message chat-message-${type} fade-in`;
                
                messageElement.innerHTML = `
                    <div class="message-content">
                        <div class="message-text">${message}</div>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;
                
                chatLog.appendChild(messageElement);
                chatLog.scrollTop = chatLog.scrollHeight;
            }

            function generateAIResponse(userMessage) {
                const responses = [
                    "I understand your requirement. Let me analyze this and provide you with a comprehensive solution.",
                    "That's an interesting challenge. Based on my expertise, I would recommend considering these approaches...",
                    "Let me break this down into manageable components and suggest the best architectural pattern.",
                    "I see the potential complexity here. Let's focus on creating a maintainable and scalable solution.",
                    "Great question! This requires careful consideration of both performance and security aspects."
                ];
                
                return responses[Math.floor(Math.random() * responses.length)];
            }

            function clearSelection() {
                document.querySelectorAll('.card-selected').forEach(card => {
                    card.classList.remove('card-selected');
                });
            }

            function simulateProcessing(duration) {
                return new Promise(resolve => setTimeout(resolve, duration));
            }

            function showError(message) {
                console.error('Error:', message);
                
                const criticalErrors = [
                    'Critical initialization error',
                    'Failed to load core data',
                    'System malfunction'
                ];
                
                const shouldShowModal = criticalErrors.some(criticalError => 
                    message.includes(criticalError)
                );
                
                if (shouldShowModal) {
                    if (dom?.errorMessage && dom?.errorModal) {
                        dom.errorMessage.textContent = message;
                        dom.errorModal.classList.remove('hidden');
                    } else {
                        const errorModal = document.getElementById('error-modal');
                        const errorMessage = document.getElementById('error-message');
                        
                        if (errorModal && errorMessage) {
                            errorMessage.textContent = message;
                            errorModal.classList.remove('hidden');
                        }
                    }
                }
            }

            function showSuccess(message) {
                const notification = document.createElement('div');
                notification.className = 'success-notification fade-in';
                notification.innerHTML = `
                    <div class="notification-content">
                        <span class="notification-icon"></span>
                        <span class="notification-message">${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            function initializeModal() {
                if (dom.closeModalBtn && dom.errorModal) {
                    dom.closeModalBtn.addEventListener('click', () => {
                        dom.errorModal.classList.add('hidden');
                    });
                }
            }

            function initializeScrollEffects() {
                if (!window.IntersectionObserver) {
                    console.warn('IntersectionObserver not supported, skipping scroll effects');
                    return;
                }
                
                try {
                    const observerOptions = {
                        threshold: 0.1,
                        rootMargin: '0px 0px -50px 0px'
                    };

                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('fade-in');
                            }
                        });
                    }, observerOptions);

                    const elements = document.querySelectorAll('.card, .info-panel, .feature-item');
                    console.log(`Found ${elements.length} elements to observe for scroll effects`);
                    
                    elements.forEach(el => {
                        observer.observe(el);
                    });
                } catch (error) {
                    console.error('Error initializing scroll effects:', error);
                }
            }
        })();
    </script>
    <script>
        // services.js content will be placed here
        (function() {
            'use strict';

            window.initializeServicesPage = function() {
                console.log('Initializing Services Page...');
                if (!window.CUA_DATA) {
                    console.error('CUA_DATA not loaded for services page. Retrying...');
                    setTimeout(window.initializeServicesPage, 100);
                    return;
                }
                populateServicesGrid();
                initializeServiceCards();
                console.log('Services Page initialized successfully.');
            };

            function populateServicesGrid() {
                const servicesGrid = document.getElementById('services-grid');
                if (!servicesGrid || !window.CUA_DATA) return;

                servicesGrid.innerHTML = '';

                window.CUA_DATA.ai_family.forEach(agent => {
                    const serviceCard = createServiceCard(agent);
                    servicesGrid.appendChild(serviceCard);
                });
            }

            function createServiceCard(agent) {
                const card = document.createElement('div');
                card.className = 'service-card fade-in';
                card.setAttribute('data-agent', agent.name);
                
                card.innerHTML = `
                    <div class="service-header">
                        <div class="service-avatar">
                            <div class="service-initial">${agent.name.charAt(0)}</div>
                        </div>
                        <div class="service-info">
                            <h3 class="service-name">${agent.name}</h3>
                            <p class="service-role">${agent.role}</p>
                        </div>
                    </div>
                    
                    <div class="service-content">
                        <p class="service-philosophy">"${agent.philosophy}"</p>
                        <p class="service-description">${agent.description || 'Specialized AI agent focused on delivering high-quality development solutions.'}</p>
                        
                        <div class="service-focus">
                            <h4 class="focus-title">Expertise Areas</h4>
                            <div class="focus-tags">
                                ${agent.focus_areas.map(area => 
                                    `<span class="focus-tag">${area}</span>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div class="service-tools">
                            <h4 class="tools-title">Tools & Technologies</h4>
                            <div class="tools-list">
                                ${agent.packaging_interrelation.map(tool => 
                                    `<div class="tool-item">
                                        <span class="tool-type">${tool.type}</span>
                                        <span class="tool-utility">${tool.utility_tool}</span>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="service-actions">
                        <a href="#contact?agent=${agent.name.toLowerCase()}" class="btn btn-primary service-cta">
                            Work with ${agent.name}
                        </a>
                        <button class="btn btn-secondary" onclick="window.showAgentDetailsFromServices('${agent.name}')">
                            Learn More
                        </button>
                    </div>
                `;
                
                return card;
            }

            function initializeServiceCards() {
                const serviceCards = document.querySelectorAll('.service-card');
                
                serviceCards.forEach(card => {
                    card.addEventListener('mouseenter', () => {
                        card.style.transform = 'translateY(-8px)';
                    });
                    
                    card.addEventListener('mouseleave', () => {
                        card.style.transform = 'translateY(0)';
                    });
                });
            }

            // Function called from service cards to show agent details (redirects to home page and opens detail panel)
            window.showAgentDetailsFromServices = function(agentName) {
                const agent = window.CUA_DATA.ai_family.find(a => a.name === agentName);
                if (agent) {
                    window.location.hash = `#home`; // Navigate to home first
                    // The main.js handleRouting will then ensure initMainPage is called,
                    // and a slight delay or event listener could be used to select the agent.
                    // For now, we'll simulate agent selection after a short delay for SPA context.
                    setTimeout(() => {
                        const agentCard = document.querySelector(`.agent-card[aria-label="Select ${agent.name} - ${agent.role}"]`);
                        if (agentCard && typeof window.CUA_App.selectAgent === 'function') {
                            window.CUA_App.selectAgent(agent, agentCard);
                        } else {
                            console.warn('Agent card or selectAgent function not found after navigation.');
                        }
                    }, 50); // Small delay to allow DOM to render and main.js to init
                }
            };
        })();
    </script>
    <script>
        // docs.js content will be placed here
        (function() {
            'use strict';

            console.log('Documentation page initializing...');

            const dom = {};
            
            function initializeDOMDocs() {
                try {
                    dom.docsNav = document.querySelector('.docs-nav');
                    dom.navLinks = document.querySelectorAll('.docs-nav .nav-link');
                    dom.docSections = document.querySelectorAll('.doc-section');
                    dom.downloadProject = document.getElementById('download-project');
                    
                    console.log('Documentation DOM elements initialized');
                } catch (error) {
                    console.error('Error initializing DOM elements for docs:', error);
                }
            }

            window.initDocsPage = function() {
                try {
                    console.log('Starting Documentation page initialization...');
                    
                    initializeDOMDocs(); // Ensure DOM elements are available
                    initializeNavigationDocs();
                    initializeScrollSpy();
                    initializeDownload();
                    initializeCodeBlocks();
                    handleUrlHash(); // Re-handle hash on SPA view change
                    
                    console.log('Documentation page initialized successfully');
                } catch (error) {
                    console.error('Error initializing Documentation page:', error);
                }
            };

            function initializeNavigationDocs() {
                if (!dom.navLinks.length) return;
                
                dom.navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        const targetId = link.getAttribute('href').substring(1);
                        const targetSection = document.getElementById(targetId);
                        
                        if (targetSection) {
                            dom.navLinks.forEach(l => l.classList.remove('active'));
                            link.classList.add('active');
                            
                            targetSection.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                            
                            history.pushState(null, null, `#docs:${targetId}`); // Update URL hash for docs sub-sections
                        }
                    });
                });
            }

            function initializeScrollSpy() {
                if (!dom.docSections.length) return;
                
                const observerOptions = {
                    root: null,
                    rootMargin: '-20% 0px -70% 0px',
                    threshold: 0
                };
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const sectionId = entry.target.id;
                            updateActiveNavLink(sectionId);
                        }
                    });
                }, observerOptions);
                
                dom.docSections.forEach(section => {
                    observer.observe(section);
                });
            }

            function updateActiveNavLink(sectionId) {
                if (!dom.navLinks.length) return;
                
                dom.navLinks.forEach(link => {
                    link.classList.remove('active');
                    
                    if (link.getAttribute('href') === `#${sectionId}`) {
                        link.classList.add('active');
                    }
                });
            }

            function initializeDownload() {
                if (!dom.downloadProject) return;
                
                dom.downloadProject.addEventListener('click', (e) => {
                    e.preventDefault();
                    showDownloadModal();
                });
            }

            function showDownloadModal() {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-overlay"></div>
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Download Project Files</h3>
                            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="download-options">
                                <div class="download-option">
                                    <h4>Complete Project Package</h4>
                                    <p>Full CUA Engine with all files, documentation, and examples</p>
                                    <ul>
                                        <li>HTML pages and components</li>
                                        <li>JavaScript functionality</li>
                                        <li>CSS styling and themes</li>
                                        <li>Documentation and guides</li>
                                        <li>Configuration examples</li>
                                    </ul>
                                    <button class="btn btn-primary" onclick="window.downloadProject('complete')">
                                        Download Complete Package (2.5 MB)
                                    </button>
                                </div>
                                
                                <div class="download-option">
                                    <h4>Core Files Only</h4>
                                    <p>Essential files for basic functionality</p>
                                    <ul>
                                        <li>Core HTML pages</li>
                                        <li>Essential JavaScript</li>
                                        <li>Basic CSS styling</li>
                                    </ul>
                                    <button class="btn btn-secondary" onclick="window.downloadProject('core')">
                                        Download Core Files (1.2 MB)
                                    </button>
                                </div>
                                
                                <div class="download-option">
                                    <h4>Documentation Only</h4>
                                    <p>Comprehensive documentation and setup guides</p>
                                    <ul>
                                        <li>Setup instructions</li>
                                        <li>API reference</li>
                                        <li>Configuration guides</li>
                                        <li>Troubleshooting help</li>
                                    </ul>
                                    <button class="btn btn-outline" onclick="window.downloadProject('docs')">
                                        Download Documentation (850 KB)
                                    </button>
                                </div>
                            </div>
                            
                            <div class="download-info">
                                <h4>System Requirements</h4>
                                <ul>
                                    <li>Modern web browser (Chrome 90+, Firefox 88+, Safari 14+)</li>
                                    <li>Web server for hosting (Apache, Nginx, or static hosting)</li>
                                    <li>No backend requirements - pure frontend application</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                modal.querySelector('.modal-overlay').addEventListener('click', () => {
                    modal.remove();
                });
            }

            window.downloadProject = function(type) {
                const downloadTypes = {
                    complete: { name: 'cua-engine-complete.zip', size: '2.5 MB' },
                    core: { name: 'cua-engine-core.zip', size: '1.2 MB' },
                    docs: { name: 'cua-engine-docs.zip', size: '850 KB' }
                };
                
                const download = downloadTypes[type];
                if (!download) return;
                
                showDownloadProgress(download.name, download.size);
                
                document.querySelector('.modal').remove();
            };

            function showDownloadProgress(filename, size) {
                const progressModal = document.createElement('div');
                progressModal.className = 'modal';
                progressModal.innerHTML = `
                    <div class="modal-overlay"></div>
                    <div class="modal-content modal-sm">
                        <div class="modal-header">
                            <h3 class="modal-title">Downloading...</h3>
                        </div>
                        <div class="modal-body">
                            <div class="download-progress">
                                <div class="progress-info">
                                    <strong>${filename}</strong>
                                    <span class="progress-size">${size}</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                                <div class="progress-text">
                                    <span id="progress-percent">0%</span>
                                    <span id="progress-status">Preparing download...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(progressModal);
                
                let progress = 0;
                const progressFill = progressModal.querySelector('#progress-fill');
                const progressPercent = progressModal.querySelector('#progress-percent');
                const progressStatus = progressModal.querySelector('#progress-status');
                
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 100) progress = 100;
                    
                    progressFill.style.width = `${progress}%`;
                    progressPercent.textContent = `${Math.round(progress)}%`;
                    
                    if (progress < 30) {
                        progressStatus.textContent = 'Preparing download...';
                    } else if (progress < 70) {
                        progressStatus.textContent = 'Downloading files...';
                    } else if (progress < 100) {
                        progressStatus.textContent = 'Finalizing...';
                    } else {
                        progressStatus.textContent = 'Download complete!';
                        clearInterval(interval);
                        
                        setTimeout(() => {
                            progressModal.remove();
                            showDownloadComplete(filename);
                        }, 1000);
                    }
                }, 200);
            }

            function showDownloadComplete(filename) {
                const completeModal = document.createElement('div');
                completeModal.className = 'modal';
                completeModal.innerHTML = `
                    <div class="modal-overlay"></div>
                    <div class="modal-content modal-sm">
                        <div class="modal-header">
                            <h3 class="modal-title">Download Complete</h3>
                            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="download-complete">
                                <div class="complete-icon"></div>
                                <p><strong>${filename}</strong> has been downloaded successfully.</p>
                                <div class="next-steps">
                                    <h4>Next Steps:</h4>
                                    <ol>
                                        <li>Extract the downloaded ZIP file</li>
                                        <li>Upload files to your web server</li>
                                        <li>Open index.html in your browser</li>
                                        <li>Follow the setup guide for configuration</li>
                                    </ol>
                                </div>
                                <div class="help-links">
                                    <a href="#docs:setup" class="btn-link" onclick="this.closest('.modal').remove();">
                                        View Setup Guide
                                    </a>
                                    <a href="#docs:troubleshooting" class="btn-link" onclick="this.closest('.modal').remove();">
                                        Troubleshooting Help
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(completeModal);
                
                completeModal.querySelector('.modal-overlay').addEventListener('click', () => {
                    completeModal.remove();
                });
            }

            function initializeCodeBlocks() {
                const codeBlocks = document.querySelectorAll('.code-block');
                
                codeBlocks.forEach(block => {
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'copy-btn';
                    copyBtn.innerHTML = ' Copy';
                    copyBtn.addEventListener('click', () => copyCodeBlock(block, copyBtn));
                    
                    block.style.position = 'relative';
                    block.appendChild(copyBtn);
                });
            }

            function copyCodeBlock(block, button) {
                const code = block.querySelector('code, pre');
                if (!code) return;
                
                const text = code.textContent;
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        showCopySuccess(button);
                    }).catch(() => {
                        fallbackCopy(text, button);
                    });
                } else {
                    fallbackCopy(text, button);
                }
            }

            function fallbackCopy(text, button) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    showCopySuccess(button);
                } catch (err) {
                    console.error('Copy failed:', err);
                }
                
                document.body.removeChild(textarea);
            }

            function showCopySuccess(button) {
                const originalText = button.innerHTML;
                button.innerHTML = ' Copied!';
                button.style.background = '#10b981';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '';
                }, 2000);
            }

            function handleUrlHash() {
                const hash = window.location.hash;
                if (hash) {
                    const parts = hash.split(':');
                    if (parts[0] === '#docs' && parts.length > 1) {
                        const targetSectionId = parts[1];
                        const targetSection = document.getElementById(targetSectionId);
                        if (targetSection) {
                            setTimeout(() => {
                                targetSection.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'start'
                                });
                                updateActiveNavLink(targetSectionId);
                            }, 100);
                        }
                    } else if (hash === '#home') { // Special handling for home to select an agent if specified
                        const urlParams = new URLSearchParams(window.location.search);
                        const agentName = urlParams.get('agent');
                        if (agentName && window.CUA_DATA && typeof window.CUA_App.selectAgent === 'function') {
                            const agent = window.CUA_DATA.ai_family.find(a => a.name.toLowerCase() === agentName.toLowerCase());
                            if (agent) {
                                setTimeout(() => {
                                    const agentCard = document.querySelector(`.agent-card[aria-label="Select ${agent.name} - ${agent.role}"]`);
                                    if (agentCard) {
                                        window.CUA_App.selectAgent(agent, agentCard);
                                    }
                                }, 100);
                            }
                        }
                    }
                }
            }
        })();
    </script>
    <script>
        // contact.js content will be placed here
        (function() {
            'use strict';

            let isSubmitting = false;

            window.initializeContactPage = function() {
                console.log('Initializing Contact Page...');
                initializeForm();
                handleURLParamsContact();
                initializeFAQ();
                console.log('Contact Page initialized successfully.');
            };

            function initializeForm() {
                const contactForm = document.getElementById('contact-form');
                if (!contactForm) return;

                contactForm.addEventListener('submit', handleFormSubmit);

                const inputs = contactForm.querySelectorAll('input, textarea, select');
                inputs.forEach(input => {
                    input.addEventListener('blur', () => validateField(input));
                    input.addEventListener('input', () => clearErrors(input));
                });
            }

            function handleURLParamsContact() {
                const urlParams = new URLSearchParams(window.location.search);
                const service = urlParams.get('service');
                const agent = urlParams.get('agent');

                if (service) {
                    const serviceSelect = document.getElementById('service');
                    if (serviceSelect) {
                        serviceSelect.value = service;
                    }
                }

                if (agent) {
                    const projectDetails = document.getElementById('project-details');
                    if (projectDetails && !projectDetails.value) {
                        projectDetails.value = `I'm interested in working with ${agent.toUpperCase()} for my project. `;
                        projectDetails.focus();
                        projectDetails.setSelectionRange(projectDetails.value.length, projectDetails.value.length);
                    }
                }
            }

            async function handleFormSubmit(e) {
                e.preventDefault();
                
                if (isSubmitting) return;
                
                const form = e.target;
                const isValid = validateForm(form);
                
                if (!isValid) return;

                isSubmitting = true;
                updateSubmitButton(true);

                try {
                    await simulateFormSubmission(new FormData(form));
                    
                    showSuccessMessage();
                    form.reset();
                    
                } catch (error) {
                    console.error('Form submission error:', error);
                    window.CUA_App.showError('Failed to send message. Please try again.'); // Using global error show
                } finally {
                    isSubmitting = false;
                    updateSubmitButton(false);
                }
            }

            function validateForm(form) {
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;

                requiredFields.forEach(field => {
                    if (!validateField(field)) {
                        isValid = false;
                    }
                });

                return isValid;
            }

            function validateField(field) {
                const value = field.value.trim();
                const fieldName = field.name;
                let isValid = true;
                let errorMessage = '';

                clearErrors(field);

                if (field.hasAttribute('required') && !value) {
                    errorMessage = `${getFieldLabel(field)} is required.`;
                    isValid = false;
                }
                else if (fieldName === 'email' && value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(value)) {
                        errorMessage = 'Please enter a valid email address.';
                        isValid = false;
                    }
                }
                else if (fieldName === 'name' && value) {
                    if (value.length < 2) {
                        errorMessage = 'Name must be at least 2 characters long.';
                        isValid = false;
                    }
                }

                if (!isValid) {
                    showFieldError(field, errorMessage);
                }

                return isValid;
            }

            function getFieldLabel(field) {
                const label = document.querySelector(`label[for="${field.id}"]`);
                return label ? label.textContent.replace('*', '').trim() : field.name;
            }

            function showFieldError(field, message) {
                const errorElement = document.getElementById(`${field.name}-error`);
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                }
                
                field.classList.add('error');
                field.setAttribute('aria-invalid', 'true');
            }

            function clearErrors(field) {
                const errorElement = document.getElementById(`${field.name}-error`);
                if (errorElement) {
                    errorElement.textContent = '';
                    errorElement.style.display = 'none';
                }
                
                field.classList.remove('error');
                field.removeAttribute('aria-invalid');
            }

            function updateSubmitButton(loading) {
                const submitBtn = document.getElementById('submit-btn');
                const btnText = submitBtn.querySelector('.btn-text');
                const btnLoading = submitBtn.querySelector('.btn-loading');

                if (loading) {
                    submitBtn.disabled = true;
                    if (btnText) btnText.classList.add('hidden');
                    if (btnLoading) btnLoading.classList.remove('hidden');
                } else {
                    submitBtn.disabled = false;
                    if (btnText) btnText.classList.remove('hidden');
                    if (btnLoading) btnLoading.classList.add('hidden');
                }
            }

            async function simulateFormSubmission(formData) {
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                console.log('Form submission data:');
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}: ${value}`);
                }
                
                return { success: true, message: 'Message sent successfully!' };
            }

            function showSuccessMessage() {
                const form = document.getElementById('contact-form');
                const successMessage = document.getElementById('success-message');
                
                if (form && successMessage) {
                    form.classList.add('hidden');
                    successMessage.classList.remove('hidden');
                    
                    successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    setTimeout(() => {
                        form.classList.remove('hidden');
                        successMessage.classList.add('hidden');
                    }, 5000);
                }
            }

            function initializeFAQ() {
                const faqItems = document.querySelectorAll('.faq-item');
                
                faqItems.forEach(item => {
                    const question = item.querySelector('.faq-question');
                    const answer = item.querySelector('.faq-answer');
                    
                    if (question && answer) {
                        question.style.cursor = 'pointer';
                        question.addEventListener('click', () => {
                            const isExpanded = answer.style.display === 'block';
                            
                            faqItems.forEach(otherItem => {
                                const otherAnswer = otherItem.querySelector('.faq-answer');
                                if (otherAnswer && otherAnswer !== answer) {
                                    otherAnswer.style.display = 'none';
                                    otherItem.classList.remove('expanded');
                                }
                            });
                            
                            if (isExpanded) {
                                answer.style.display = 'none';
                                item.classList.remove('expanded');
                            } else {
                                answer.style.display = 'block';
                                item.classList.add('expanded');
                            }
                        });
                    }
                });
            }
        })();
    </script>
    <script>
        // SPA Router Logic
        (function() {
            'use strict';

            const pageSections = document.querySelectorAll('.page-section');
            const navLinks = document.querySelectorAll('.nav-links .nav-link');

            function hideAllPages() {
                pageSections.forEach(section => section.classList.add('hidden'));
            }

            function setActiveNavLink(hash) {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.navTarget === hash.split(':')[0].substring(1)) {
                        link.classList.add('active');
                    }
                });
            }

            function handleRouting() {
                const hash = window.location.hash || '#home';
                const mainHash = hash.split(':')[0]; // Get #home, #services etc.
                const subHash = hash.split(':')[1] || ''; // For docs sub-sections

                hideAllPages();
                setActiveNavLink(hash);

                let pageToShow = null;

                switch (mainHash) {
                    case '#home':
                        pageToShow = document.getElementById('home-page');
                        if (pageToShow) {
                            pageToShow.classList.remove('hidden');
                            window.initMainPage(); // Re-initialize home page components
                            // Handle agent selection from services page link
                            const urlParams = new URLSearchParams(window.location.search);
                            const agentName = urlParams.get('agent');
                            if (agentName && window.CUA_DATA && typeof window.CUA_App.selectAgent === 'function') {
                                const agent = window.CUA_DATA.ai_family.find(a => a.name.toLowerCase() === agentName.toLowerCase());
                                if (agent) {
                                    const agentCard = document.querySelector(`.agent-card[aria-label="Select ${agent.name} - ${agent.role}"]`);
                                    if (agentCard) {
                                        window.CUA_App.selectAgent(agent, agentCard);
                                    }
                                }
                            }
                        }
                        break;
                    case '#services':
                        pageToShow = document.getElementById('services-page');
                        if (pageToShow) {
                            pageToShow.classList.remove('hidden');
                            window.initializeServicesPage(); // Re-initialize services page
                        }
                        break;
                    case '#docs':
                        pageToShow = document.getElementById('docs-page');
                        if (pageToShow) {
                            pageToShow.classList.remove('hidden');
                            window.initDocsPage(); // Re-initialize docs page
                            if (subHash) { // Scroll to specific section if sub-hash exists
                                const targetSection = document.getElementById(subHash);
                                if (targetSection) {
                                    setTimeout(() => {
                                        targetSection.scrollIntoView({
                                            behavior: 'smooth',
                                            block: 'start'
                                        });
                                    }, 100);
                                }
                            }
                        }
                        break;
                    case '#contact':
                        pageToShow = document.getElementById('contact-page');
                        if (pageToShow) {
                            pageToShow.classList.remove('hidden');
                            window.initializeContactPage(); // Re-initialize contact page
                        }
                        break;
                    case '#orchestration-hub':
                        pageToShow = document.getElementById('orchestration-hub-page');
                        if (pageToShow) {
                            pageToShow.classList.remove('hidden');
                            window.initializeOrchestrationHub(); // Re-initialize orchestration hub
                        }
                        break;
                    default:
                        // Fallback to home if hash is unrecognized
                        window.location.hash = '#home';
                        break;
                }
            }

            // Initial routing on page load
            window.addEventListener('DOMContentLoaded', () => {
                handleRouting();
            });

            // Listen for hash changes
            window.addEventListener('hashchange', handleRouting);
        })();
    </script>
</body>
</html>
